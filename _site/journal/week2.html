<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on https://github.com/jonrohan -->
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="stylesheet" href="/assets/css/style.css?v=8a13aad017ff6ad69fb842d026f4ce5260c12cc5">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <script src="/assets/js/script.js"></script>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Final Week‚ÇÇ Of The Bootcamp | Cloud Express</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Final Week‚ÇÇ Of The Bootcamp" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Your Perfect Starting Point To The Cloud with Yaya Legacy." />
<meta property="og:description" content="Your Perfect Starting Point To The Cloud with Yaya Legacy." />
<link rel="canonical" href="http://localhost:4000/journal/week2.html" />
<meta property="og:url" content="http://localhost:4000/journal/week2.html" />
<meta property="og:site_name" content="Cloud Express" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Final Week‚ÇÇ Of The Bootcamp" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Your Perfect Starting Point To The Cloud with Yaya Legacy.","headline":"Final Week‚ÇÇ Of The Bootcamp","url":"http://localhost:4000/journal/week2.html"}</script>
<!-- End Jekyll SEO tag -->


  <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Cloud Express</h1>
    </header>
    <div id="container">
      <p class="tagline">Your Perfect Starting Point To The Cloud with Yaya Legacy.</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          
          <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tarball/gh-pages" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/zipball/gh-pages" class="download-button zip"><span>Download</span></a>
          
          <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023" class="code">View Cloud Express on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1 id="final-week-of-the-bootcamp">Final Week‚ÇÇ Of The Bootcamp</h1>

<p>The past week was absolutely fantastic and filled with excitement.</p>

<blockquote>
  <p><a href="/">Go Back.</a></p>
</blockquote>

<p>We embarked on some incredible tech adventures, such as crafting our very own Ruby server and designing a custom Terraform provider in Go.</p>

<ul>
  <li><a href="#create-a--200--ruby-server">Create A <code class="language-plaintext highlighter-rouge">2.0.0</code> Ruby Server</a></li>
  <li><a href="#terratowns-provider-skeleton">TerraTowns Provider Skeleton</a></li>
  <li><a href="#terratowns-terraform-block">Terratowns Terraform Block</a></li>
  <li><a href="#terratowns-resource-skeleton">TerraTowns Resource Skeleton</a></li>
  <li><a href="#terratowns--home--resource">TerraTowns <code class="language-plaintext highlighter-rouge">Home</code> Resource</a></li>
  <li><a href="#target-terratowns-api">Target TerraTowns API</a></li>
  <li><a href="#terraform-turbocharge-workflow">Terraform Turbocharge Workflow</a></li>
  <li><a href="#terrahomes-to-terratowns">üè† TerraHomes to TerraTowns</a></li>
  <li><a href="#terratowns-potential-unlocked">üèôÔ∏è TerraTowns Potential Unlocked</a></li>
</ul>

<p>To add to the thrill, I personally launched six TerraTowns projects to TerraTowns.</p>

<p>It was a whirlwind of productivity and innovation, and we can‚Äôt wait to share the fruits of our labor with all Terraformers!</p>

<h1 id="create-a-200-ruby-server">Create A <code class="language-plaintext highlighter-rouge">2.0.0</code> Ruby Server</h1>
<p>In version <code class="language-plaintext highlighter-rouge">2.0.0</code> of our project, the primary focus is on integrating the Terratown mock server into our repository.</p>

<ul>
  <li><a href="#adjust-gitpod-yaml-configuration">Sinatra In Gitpod</a></li>
  <li><a href="#üé©-understanding-sinatra">Code Sinatra Server</a></li>
  <li><a href="#bash-script-for-cruds">Bash Script for CRUDs</a></li>
  <li><a href="#speak-to-sinatra">Speak To Your Sinatra</a></li>
  <li><a href="#relaunch-the-server">Final Server Testing</a></li>
</ul>

<p>There are many ways for embedding the mock server:</p>

<p><strong>A way can be;</strong>
|ü§î|We can include it as a submodule|
|‚Äî:|:‚Äî|
|üêõ|Challenging to manage when issues arise|</p>

<p><strong>Another way may be;</strong>
|ü§î|Git checkout and refrain from committing |
|‚Äî:|:‚Äî|
|üö´|limiting when it comes to making on-the-fly changes|</p>

<p>We are going with <strong>the first.</strong></p>

<h3 id="bringing-terratown-mock-server-into-our-repository">Bringing Terratown Mock Server into Our Repository</h3>

<ol>
  <li>git clone the <code class="language-plaintext highlighter-rouge">terratowns_mock_server</code> repository to our project.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/ExamProCo/terratowns_mock_server.git
</code></pre></div>    </div>
  </li>
  <li>cd to <code class="language-plaintext highlighter-rouge">terratowns_mock_server</code> and verify the <code class="language-plaintext highlighter-rouge">.git</code> existence.</li>
</ol>

<p><img src="/assets/2.0.0/thegit-folder.png" alt="Dotgit is hidden here" /></p>

<ol>
  <li>Remove the <code class="language-plaintext highlighter-rouge">.git</code> directory from the cloned repository.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm -rf .git
</code></pre></div>    </div>
  </li>
  <li>Verify the contents is gone using <code class="language-plaintext highlighter-rouge">ls -la</code>.</li>
  <li>Go a level back and verify your very critical <code class="language-plaintext highlighter-rouge">.git</code> folder for the entire project.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd .. &amp;&amp; ls -la
</code></pre></div>    </div>
  </li>
</ol>

<p><img src="/assets/2.0.0/root-git-safe.png" alt="Root dotgit is Safe Plz" /></p>

<p>Good. Take care.. ü§≤</p>

<h3 id="adjust-gitpod-yaml-configuration">Adjust Gitpod YAML Configuration</h3>
<p>The Gitpod in that cloned project won‚Äôt work because Gitpod operates only on the root level.</p>
<ol>
  <li>Move the Gitpod configuration from the cloned repository to the root level of our project.
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">sinatra</span>
 <span class="na">init</span><span class="pi">:</span> <span class="pi">|</span> 
   <span class="s">bundle install</span>
   <span class="s">bundle exec ruby server.rb </span>
</code></pre></div>    </div>
    <p>Include it in the <code class="language-plaintext highlighter-rouge">terraform</code> section.</p>
  </li>
  <li>Add <code class="language-plaintext highlighter-rouge">cd $PROJECT_ROOT</code> before your terraform, <code class="language-plaintext highlighter-rouge">aws-cli</code> and <code class="language-plaintext highlighter-rouge">http-server</code> section.</li>
  <li>Terminate the previous Gitpod workspace because It is usless.
    <h3 id="adjust-the-repository-structure">Adjust the Repository Structure</h3>
  </li>
  <li>Change the <code class="language-plaintext highlighter-rouge">bin</code> folder to <code class="language-plaintext highlighter-rouge">terratowns</code>.</li>
  <li>Move scripts to our great <code class="language-plaintext highlighter-rouge">bin</code> directory.</li>
  <li>Perform necessary chmod operations on these files.</li>
  <li>delete the come with server <code class="language-plaintext highlighter-rouge">bin</code> directory.</li>
</ol>

<h2 id="-understanding-sinatra">üé© Understanding Sinatra</h2>
<p>Sinatra is a web application framework. Visit <a href="http://sinatrarb.com">sinatrarb.com</a> for more..</p>

<p>The <code class="language-plaintext highlighter-rouge">server.rb</code> file works with the gems listed in the <code class="language-plaintext highlighter-rouge">Gemfile</code> to make the server work.</p>

<h4 id="sinatra-server-master">Sinatra Server Master</h4>
<ul>
  <li>Learn about Active Model in Rails as an ORM.</li>
  <li>Explore getter and setter methods.</li>
  <li>Study Rails validations and their formats.</li>
</ul>

<p><img src="/journal/architectures/week2-anatomy-request.png" alt="Diagram Server" /></p>

<p>Lets start coding the server in a single file to make it easier for you.</p>

<ol>
  <li><strong>Import Required Libraries</strong>:
    <ul>
      <li>Import the necessary libraries <code class="language-plaintext highlighter-rouge">pry</code> and <code class="language-plaintext highlighter-rouge">active_model</code>.
        <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'pry'</span>
<span class="nb">require</span> <span class="s1">'active_model'</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Create a Mock Database</strong>:
    <ul>
      <li>Set a global variable <code class="language-plaintext highlighter-rouge">$home</code> to an empty hash. (Note: Avoid using global variables in production environments.)
        <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$home</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Define the <code class="language-plaintext highlighter-rouge">Home</code> Class</strong>:
    <ul>
      <li>Create a Ruby class named <code class="language-plaintext highlighter-rouge">Home</code> representing a resource.</li>
      <li>Include validations from <code class="language-plaintext highlighter-rouge">ActiveModel</code>, which provides validation functionality.
        <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Home</span>
<span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span>
<span class="k">end</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Define Attributes for the <code class="language-plaintext highlighter-rouge">Home</code> Class</strong>:
    <ul>
      <li>Define virtual attributes using <code class="language-plaintext highlighter-rouge">attr_accessor</code> for <code class="language-plaintext highlighter-rouge">town</code>, <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">description</code>, <code class="language-plaintext highlighter-rouge">domain_name</code>, and <code class="language-plaintext highlighter-rouge">content_version</code>.
        <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">attr_accessor</span> <span class="ss">:town</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">:domain_name</span><span class="p">,</span> <span class="ss">:content_version</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Apply Validations to <code class="language-plaintext highlighter-rouge">Home</code> Class Attributes</strong>:
    <ul>
      <li>Use <code class="language-plaintext highlighter-rouge">validates</code> to specify validations for attributes:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">town</code> must be present and belong to a predefined list.</li>
          <li><code class="language-plaintext highlighter-rouge">name</code> must be present.</li>
          <li><code class="language-plaintext highlighter-rouge">description</code> must be present.</li>
          <li><code class="language-plaintext highlighter-rouge">domain_name</code> must have a specific format.</li>
          <li><code class="language-plaintext highlighter-rouge">content_version</code> must be an integer.
            <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="n">validates</span> <span class="ss">:description</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
<span class="n">validates</span> <span class="ss">:domain_name</span><span class="p">,</span> 
 <span class="ss">format: </span><span class="p">{</span> <span class="ss">with: </span><span class="sr">/\.cloudfront\.net\z/</span><span class="p">,</span> <span class="ss">message: </span><span class="s2">"domain must be from .cloudfront.net"</span> <span class="p">}</span>
<span class="n">validates</span> <span class="ss">:content_version</span><span class="p">,</span> <span class="ss">numericality: </span><span class="p">{</span> <span class="ss">only_integer: </span><span class="kp">true</span> <span class="p">}</span>
</code></pre></div>            </div>
            <blockquote>
              <p>Visit <a href="https://terratowns.cloud">terratowns.cloud</a> and explore <code class="language-plaintext highlighter-rouge">cooker-coke,</code> the permalink for validation.</p>
            </blockquote>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Define the <code class="language-plaintext highlighter-rouge">TerraTownsMockServer</code> Class</strong>:
    <ul>
      <li>Extend a class from Sinatra (<code class="language-plaintext highlighter-rouge">Sinatra::Base</code>) to create a web server.
        <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TerraTownsMockServer</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Define Error Handling Function</strong>:
    <ul>
      <li>Create a method <code class="language-plaintext highlighter-rouge">error</code> to handle errors by providing an error code and message.
        <div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">error</span> <span class="n">code</span><span class="p">,</span> <span class="n">message</span>
 <span class="n">halt</span> <span class="n">code</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">},</span> <span class="p">{</span><span class="ss">err: </span><span class="n">message</span><span class="p">}.</span><span class="nf">to_json</span>
<span class="k">end</span>
<span class="k">def</span> <span class="nf">error_json</span> <span class="n">json</span>
 <span class="n">halt</span> <span class="n">code</span><span class="p">,</span> <span class="p">{</span><span class="s1">'Content-Type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">},</span> <span class="n">json</span>
<span class="k">end</span>
<span class="k">def</span> <span class="nf">ensure_correct_headings</span>
 <span class="k">unless</span> <span class="n">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s2">"CONTENT_TYPE"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"application/json"</span>
 <span class="n">error</span> <span class="mi">415</span><span class="p">,</span> <span class="s2">"expected Content_type header to be application/json"</span>
 <span class="k">end</span>
 <span class="k">unless</span> <span class="n">request</span><span class="p">.</span><span class="nf">env</span><span class="p">[</span><span class="s2">"HTTP_ACCEPT"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"application/json"</span>
 <span class="n">error</span> <span class="mi">406</span><span class="p">,</span> <span class="s2">"expected Accept header to be application/json"</span>
 <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Define Helper Methods</strong>:
    <ul>
      <li>Create helper methods <code class="language-plaintext highlighter-rouge">x_access_code</code> and <code class="language-plaintext highlighter-rouge">x_user_uuid</code> to return hardcoded values.</li>
      <li>Implement <code class="language-plaintext highlighter-rouge">find_user_by_bearer_token</code> to authenticate requests using bearer tokens.</li>
    </ul>
  </li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">x_access_code</span>
    <span class="k">return</span> <span class="s1">'9b49b3fb-b8e9-483c-b703-97ba88eef8e0'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">x_user_uuid</span>
    <span class="k">return</span> <span class="s1">'e328f4ab-b99f-421c-84c9-4ccea042c7d1'</span>
  <span class="k">end</span>
</code></pre></div></div>
<p>Add the return otherwise it wont work. and I created for you <code class="language-plaintext highlighter-rouge">find_user_by_bearer_token</code> method responsible for authenticating requests that use Bearer token-based authentication.</p>

<ol>
  <li><strong>Create a POST Endpoint for Creating Homes</strong>:
    <ul>
      <li>Define a POST route <code class="language-plaintext highlighter-rouge">/api/u/:user_uuid/homes</code>.</li>
      <li>Ensure correct headers and user authentication.</li>
      <li>Parse the JSON request body.</li>
      <li>Validate and extract attributes from the payload.</li>
      <li>Create a new <code class="language-plaintext highlighter-rouge">Home</code> instance and set its attributes.</li>
      <li>Check if validations pass; if not, return validation errors.</li>
      <li>Generate a UUID, mock data, and return the UUID as JSON.</li>
    </ul>
  </li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">post</span> <span class="s1">'/api/u/:user_uuid/homes'</span> <span class="k">do</span>
    <span class="n">ensure_correct_headings</span><span class="p">()</span>
    <span class="n">find_user_by_bearer_token</span><span class="p">()</span>
    <span class="c1"># puts will print to the terminal similar to a print or console.log</span>
    <span class="nb">puts</span> <span class="s2">"# create - POST /api/homes"</span>

    <span class="c1"># a begin/resurce is a try/catch, if an error occurs, result it.</span>
    <span class="k">begin</span>
      <span class="c1"># Sinatra does not automatically part json bodys as params</span>
      <span class="c1"># like rails so we need to manuall parse it.</span>
      <span class="n">payload</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">read</span><span class="p">)</span>
    <span class="k">rescue</span> <span class="no">JSON</span><span class="o">::</span><span class="no">ParserError</span>
      <span class="n">halt</span> <span class="mi">422</span><span class="p">,</span> <span class="s2">"Malformed JSON"</span>
    <span class="k">end</span>

    <span class="c1"># assign the payload to variables</span>
    <span class="c1"># to make easier to work with the code</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"description"</span><span class="p">]</span>
    <span class="n">domain_name</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"domain_name"</span><span class="p">]</span>
    <span class="n">content_version</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"content_version"</span><span class="p">]</span>
    <span class="n">town</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"town"</span><span class="p">]</span>

    <span class="c1"># printing the variables out to console to make it eaiser</span>
    <span class="c1"># to see or debug what we have inputed into this endpoint</span>
    <span class="nb">puts</span> <span class="s2">"name </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s2">"description </span><span class="si">#{</span><span class="n">description</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s2">"domain_name </span><span class="si">#{</span><span class="n">domain_name</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s2">"content_version </span><span class="si">#{</span><span class="n">content_version</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s2">"town </span><span class="si">#{</span><span class="n">town</span><span class="si">}</span><span class="s2">"</span>

    <span class="c1"># Create a new Home model and set to attributes</span>
    <span class="n">home</span> <span class="o">=</span> <span class="no">Home</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">town</span> <span class="o">=</span> <span class="n">town</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">domain_name</span> <span class="o">=</span> <span class="n">domain_name</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">content_version</span> <span class="o">=</span> <span class="n">content_version</span>
    
    <span class="c1"># ensure our validation checks pass otherwise</span>
    <span class="c1"># return the errors</span>
    <span class="k">unless</span> <span class="n">home</span><span class="p">.</span><span class="nf">valid?</span>
      <span class="c1"># return the errors message back json</span>
      <span class="n">error</span> <span class="mi">422</span><span class="p">,</span> <span class="n">home</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span><span class="p">.</span><span class="nf">to_json</span>
    <span class="k">end</span>

    <span class="c1"># generating a uuid at random.</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="p">.</span><span class="nf">uuid</span>
    <span class="nb">puts</span> <span class="s2">"uuid </span><span class="si">#{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">"</span>
    <span class="c1"># will mock our data to our mock databse</span>
    <span class="c1"># which just a global variable</span>
    <span class="vg">$home</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">uuid: </span><span class="n">uuid</span><span class="p">,</span>
      <span class="ss">name: </span><span class="nb">name</span><span class="p">,</span>
      <span class="ss">town: </span><span class="n">town</span><span class="p">,</span>
      <span class="ss">description: </span><span class="n">description</span><span class="p">,</span>
      <span class="ss">domain_name: </span><span class="n">domain_name</span><span class="p">,</span>
      <span class="ss">content_version: </span><span class="n">content_version</span>
    <span class="p">}</span>

    <span class="c1"># will jsut return uuid</span>
    <span class="k">return</span> <span class="p">{</span> <span class="ss">uuid: </span><span class="n">uuid</span> <span class="p">}.</span><span class="nf">to_json</span>
  <span class="k">end</span>
</code></pre></div></div>
<ol>
  <li><strong>Create a GET Endpoint for Retrieving Homes</strong>:
    <ul>
      <li>Define a GET route <code class="language-plaintext highlighter-rouge">/api/u/:user_uuid/homes/:uuid</code>.</li>
      <li>Ensure correct headers and user authentication.</li>
      <li>Check if the requested UUID matches the one in the mock database.</li>
      <li>Return the corresponding home data as JSON, or an error if not found.</li>
    </ul>
  </li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">get</span> <span class="s1">'/api/u/:user_uuid/homes/:uuid'</span> <span class="k">do</span>
    <span class="n">ensure_correct_headings</span>
    <span class="n">find_user_by_bearer_token</span>
    <span class="nb">puts</span> <span class="s2">"# read - GET /api/homes/:uuid"</span>

    <span class="c1"># checks for house limit</span>

    <span class="n">content_type</span> <span class="ss">:json</span>
    <span class="c1"># does the uuid for the home match the one in our mock database</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span> <span class="o">==</span> <span class="vg">$home</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span>
      <span class="k">return</span> <span class="vg">$home</span><span class="p">.</span><span class="nf">to_json</span>
    <span class="k">else</span>
      <span class="n">error</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">"failed to find home with provided uuid and bearer token"</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div>
<ol>
  <li><strong>Create a PUT Endpoint for Updating Homes</strong>:
    <ul>
      <li>Define a PUT route <code class="language-plaintext highlighter-rouge">/api/u/:user_uuid/homes/:uuid</code>.</li>
      <li>Ensure correct headers and user authentication.</li>
      <li>Parse the JSON request body, validate and extract attributes.</li>
      <li>Find the home by UUID in the mock database and update its attributes.</li>
      <li>Return a success message as JSON.</li>
    </ul>
  </li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># UPDATE</span>
  <span class="c1"># very similar to create action</span>
  <span class="n">put</span> <span class="s1">'/api/u/:user_uuid/homes/:uuid'</span> <span class="k">do</span>
    <span class="n">ensure_correct_headings</span>
    <span class="n">find_user_by_bearer_token</span>
    <span class="nb">puts</span> <span class="s2">"# update - PUT /api/homes/:uuid"</span>
    <span class="k">begin</span>
      <span class="c1"># Parse JSON payload from the request body</span>
      <span class="n">payload</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">body</span><span class="p">.</span><span class="nf">read</span><span class="p">)</span>
    <span class="k">rescue</span> <span class="no">JSON</span><span class="o">::</span><span class="no">ParserError</span>
      <span class="n">halt</span> <span class="mi">422</span><span class="p">,</span> <span class="s2">"Malformed JSON"</span>
    <span class="k">end</span>

    <span class="c1"># Validate payload data</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"description"</span><span class="p">]</span>
    <span class="n">content_version</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="s2">"content_version"</span><span class="p">]</span>

    <span class="k">unless</span> <span class="n">params</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span> <span class="o">==</span> <span class="vg">$home</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span>
      <span class="n">error</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">"failed to find home with provided uuid and bearer token"</span>
    <span class="k">end</span>

    <span class="n">home</span> <span class="o">=</span> <span class="no">Home</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">town</span> <span class="o">=</span> <span class="vg">$home</span><span class="p">[</span><span class="ss">:town</span><span class="p">]</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">domain_name</span> <span class="o">=</span> <span class="vg">$home</span><span class="p">[</span><span class="ss">:domain_name</span><span class="p">]</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="n">home</span><span class="p">.</span><span class="nf">content_version</span> <span class="o">=</span> <span class="n">content_version</span>

    <span class="k">unless</span> <span class="n">home</span><span class="p">.</span><span class="nf">valid?</span>
      <span class="n">error</span> <span class="mi">422</span><span class="p">,</span> <span class="n">home</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">messages</span><span class="p">.</span><span class="nf">to_json</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="p">{</span> <span class="ss">uuid: </span><span class="n">params</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span> <span class="p">}.</span><span class="nf">to_json</span>
  <span class="k">end</span>
</code></pre></div></div>
<ol>
  <li><strong>Create a DELETE Endpoint for Deleting Homes</strong>:
    <ul>
      <li>Define a DELETE route <code class="language-plaintext highlighter-rouge">/api/u/:user_uuid/homes/:uuid</code>.</li>
      <li>Ensure correct headers and user authentication.</li>
      <li>Find the home by UUID in the mock database and delete it.</li>
      <li>Return a success message as JSON.</li>
    </ul>
  </li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># DELETE</span>
  <span class="n">delete</span> <span class="s1">'/api/u/:user_uuid/homes/:uuid'</span> <span class="k">do</span>
    <span class="n">ensure_correct_headings</span>
    <span class="n">find_user_by_bearer_token</span>
    <span class="nb">puts</span> <span class="s2">"# delete - DELETE /api/homes/:uuid"</span>
    <span class="n">content_type</span> <span class="ss">:json</span>

    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span> <span class="o">!=</span> <span class="vg">$home</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span>
      <span class="n">error</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">"failed to find home with provided uuid and bearer token"</span>
    <span class="k">end</span>

    <span class="c1"># delete from mock database</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="vg">$home</span><span class="p">[</span><span class="ss">:uuid</span><span class="p">]</span>
    <span class="vg">$home</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="p">{</span> <span class="ss">uuid: </span><span class="n">uuid</span> <span class="p">}.</span><span class="nf">to_json</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<ol>
  <li><strong>Run the Server</strong>:
    <ul>
      <li>Start the Sinatra server by calling <code class="language-plaintext highlighter-rouge">TerraTownsMockServer.run!</code></li>
    </ul>
  </li>
</ol>

<h2 id="bash-script-for-cruds">Bash Script for CRUDs</h2>

<p>This originates from the LLM, which serves as the foundational source‚Ä¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The How:
------
Write me a bash script that will send me a post request and an endpoint 
------
localhost:4567/api/u/:user_uuid/homes/ with a POST it should have a headers of content type and accept application json.
------
It should expect a bearer authorization token
------
The payload json should have the follownig fileds, name description, content_version, town, domain name.
</code></pre></div></div>

<h3 id="create-the-create-script">Create The Create Script</h3>
<p>Now let‚Äôs do it.</p>
<ol>
  <li>Before proceeding, ensure the server is stopped, as changes require a full restart.
Note: Consider adding a script for automatic server restart in the future.</li>
  <li>Use ‚ÄòCtrl + C‚Äô to stop the server.</li>
  <li>Write a Bash script that sends a POST request to an endpoint:
    <ul>
      <li>Endpoint: <code class="language-plaintext highlighter-rouge">localhost:4567/api/u/:user_uuid/homes/</code></li>
      <li>Headers: Content-Type and Accept should be set to ‚Äúapplication/json.‚Äù</li>
      <li>Expect a Bearer Authorization Token.</li>
      <li>Payload JSON fields: name, description, content_version, town, domain name.</li>
    </ul>
  </li>
  <li>Run <code class="language-plaintext highlighter-rouge">bundle exec</code> command to get the server back</li>
  <li>Run the ‚Äòterratowns/create‚Äô script to obtain the UUID for the house.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./create
{"uuid":"51a588f5-18c2-461b-ba97-adfd520eb9a9"}
</code></pre></div>    </div>
    <p><img src="/assets/2.0.0/cruds/first-create.png" alt="PoC Tab" /></p>
  </li>
</ol>

<h3 id="perform-the-read-script">Perform The Read Script</h3>

<p>It is the exact same. To run the script.</p>
<ol>
  <li>Perform a read script using the UUID obtained from the create step.</li>
  <li>Run the command as follows <code class="language-plaintext highlighter-rouge">./read &lt;uuid&gt;</code>
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51a588f5-18c2-461b-ba97-adfd520eb9a9"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New House"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"town"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cooker-cove"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A new house description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"domain_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3xf332sdfs.cloudfront.net"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
    <h3 id="perform-the-update-script">Perform The Update Script</h3>
  </li>
</ol>

<p><strong>To run the script;</strong></p>
<ol>
  <li>Perform a update script using the UUID obtained from the create step.</li>
  <li>Run the command as follows <code class="language-plaintext highlighter-rouge">./update &lt;uuid&gt;</code></li>
</ol>

<p>When attempting an update. <br />
It will complain. This is our code trap.<br />
Expect an error related to domain names; this is intentional.</p>

<ol>
  <li>Investigate and correct the issue within the update action (line 216).</li>
  <li>Add the domain name to the update action like town</li>
</ol>

<p>The domain names and the town should only be init once.<br /></p>

<ol>
  <li>Run udpate again.. give same error because we have to rerun the server.</li>
  <li>Do new create get new uuid, read and then update.</li>
</ol>

<p><strong>Error. again?</strong></p>

<p>The issue involves a duplicated line in the domain name, but instead of rectifying it, let‚Äôs consider appending the following information at the end.</p>

<p>We can employ <code class="language-plaintext highlighter-rouge">binding.pry</code> to pause the program‚Äôs execution in ruby.</p>

<ol>
  <li>Create a new record to generate a fresh <code class="language-plaintext highlighter-rouge">UUID</code>, read the data, and subsequently update it.</li>
</ol>

<p>It is currently hanging, and this is expected behavior.</p>

<ol>
  <li>Now, let‚Äôs switch to Sinatra where it has paused.<br />Allowing us to interact directly with the code.</li>
</ol>

<blockquote>
  <p>Should we refactor it?(maybe later) Lets just get the update.</p>
</blockquote>

<h3 id="speak-to-sinatra">Speak to Sinatra</h3>

<ol>
  <li>Type <code class="language-plaintext highlighter-rouge">home</code> =&gt; It is now displaying.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">home.domain_name</code>.</li>
  <li>Inspect the payload and observe that there is no domain present. It should not be set there.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">$home[:domain_name]</code>‚Äîthis seems to be the issue.</li>
  <li>Realize that there is no need for <code class="language-plaintext highlighter-rouge">home.domain_name = domain_name</code>, and it‚Äôs better to keep the one with <code class="language-plaintext highlighter-rouge">[]</code>.</li>
  <li>Exit the current operation.</li>
</ol>

<h3 id="relaunch-the-server">Relaunch the server</h3>

<p><strong>Server Reset and Interaction Steps</strong></p>

<ol>
  <li>Begin by restarting the server.</li>
  <li>Perform the sequence of actions: create, read, and update.
    <blockquote>
      <p>Great, everything‚Äôs in order now! Proceed to Sinatra and carefully observe all the steps.</p>
    </blockquote>
  </li>
</ol>

<table>
  <thead>
    <tr>
      <th>In sinatra review the ‚Äòread‚Äô operation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Focus on the new house description</td>
    </tr>
    <tr>
      <td>You can delete it now</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>Append the UUID at the end, around line 240. (Note: This is not a code trap but a necessary fix.)</li>
  <li>Execute the ‚Äòdelete‚Äô operation, and you‚Äôll see it tell you about the UUID.
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"err"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failed to find home with provided uuid and bearer token"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Do new create to get new uuid,
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"uuid"</span><span class="p">:</span><span class="s2">"82966322-962d-4910-b9e9-a4013a765730"</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Do the read script
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"82966322-962d-4910-b9e9-a4013a765730"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New House"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"town"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cooker-cove"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A new house description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"domain_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3xf332sdfs.cloudfront.net"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"content_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Do the Update;
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"uuid"</span><span class="p">:</span><span class="s2">"82966322-962d-4910-b9e9-a4013a765730"</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>And end it with Delete;</li>
</ol>

<p><img src="/assets/2.0.0/cruds/delete-is-enough.png" alt="Delete Script Winner" /></p>

<p>Our CRUDs are well set.</p>

<p><strong>Note:</strong> These are all similar scripts, with slight variations such as one for POST, one for GET, and so on.</p>

<h4 id="code-considerations">Code Considerations</h4>
<ul>
  <li>Create, read, update, and delete scripts have been provided.</li>
  <li>Ensure that they return the expected results.</li>
  <li>Has noticed another code trap that has gone unnoticed? (there is)</li>
  <li>Are there any thoughts on refactoring the code?</li>
</ul>

<p>At this point our server is well set!<br />
Once all previous steps are completed successfully, We are ready to build the custom provider.</p>

<h1 id="terratowns-provider-skeleton">TerraTowns Provider Skeleton</h1>
<p>Welcome to the quickstart of our completely custom terraform provider. <br />Typically, it‚Äôs recommended to develop a custom provider in a separate repository as an independent project.</p>

<p><strong>We‚Äôll nest it, empowered, within our project for this instance.</strong></p>

<ul>
  <li><a href="#create-your-custom-provider">Create Your Custom Provider</a></li>
  <li><a href="#provider-functionality">Provider Functionality</a></li>
  <li><a href="#importing-in-go">Imports In Go Lanugage</a></li>
  <li><a href="#plugin-setup">Setup Terrtowns Plugins</a></li>
  <li><a href="#complie-your-custom-provider">Complie Your Custom Provider</a></li>
  <li><a href="#-modgo--is-a-must"><code class="language-plaintext highlighter-rouge">mod.go</code> Requirement File</a></li>
  <li><a href="#real-build-check">Build Custom Provider Skeleton</a></li>
</ul>

<p>When you visit any provider on the Terraform Registry, you‚Äôll notice a consistent naming pattern.</p>

<table>
  <thead>
    <tr>
      <th>terraform-provider-name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>¬†</td>
    </tr>
  </tbody>
</table>

<p><a href="https://registry.terraform.io/browse/providers?tier=community">Browse and see for yourself</a>. <br />I filtered it for you on communtiy tier already. Also..</p>
<ul>
  <li>Consult back the custom providers stuctures and code blocks.</li>
  <li>Hasicups is a very good project for learning Terraform.</li>
  <li>Community often includes individuals who start and complete their providers.</li>
</ul>

<p>Over the past weeks, we‚Äôve been actively experimenting with a variety of exciting technologies and the fun just started.</p>

<h3 id="create-your-custom-provider">Create Your Custom Provider</h3>
<p>We‚Äôve successfully developed our Ruby server with the assistance of Sinatra, and now, we‚Äôre diving into Go to enhance our skills as we work on creating the custom provider.</p>

<ol>
  <li>Create a new folder and name it <code class="language-plaintext highlighter-rouge">terraform-provider-terratowns</code> at root level.</li>
  <li>Inside this folder, create a file named <code class="language-plaintext highlighter-rouge">main.go</code>. (Single file for simplicity)</li>
  <li>Consolidate the code into a single file for improved readability.</li>
  <li>In the <code class="language-plaintext highlighter-rouge">main.go</code> file, structure the code as follows:
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">package</span> <span class="n">main</span>
    
 <span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="c">// Your code here</span>
 <span class="p">}</span>
</code></pre></div>    </div>
    <blockquote>
      <p>We always have the package main.</p>
    </blockquote>
  </li>
</ol>

<p>Use (done) GPT to generate a ‚ÄúHello World‚Äù program using the Go package and print the result.</p>

<ol>
  <li>Now, let‚Äôs create a simple ‚ÄúHello World‚Äù program in Go.</li>
</ol>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"fmt"</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div></div>

<ul>
  <li>Unlike languages like Ruby, Go files are compiled into binaries</li>
  <li>Unlike languages like Ruby Go files are not dynamically executed.</li>
  <li>You compile the script, and it runs as a binary.</li>
</ul>

<p>Go is built-in on Gitpod.</p>

<table>
  <thead>
    <tr>
      <th><a href="https://blog.yahya-abulhaj.dev/the-technology-titan-go-language">Locally I installed it previously</a> and it took time for vars.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>¬†</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>Run your first Go program.
```sh
(51-terratowns-skeleton)
$ go run main.go</li>
</ol>

<p>$ go run main.go 
Hello, World!</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Provider Functionality
Our custom Terraform provider will provide CRUD operations for a resource. 

Make a Request to LLM in the meanwhile.
</code></pre></div></div>
<p>Generate code for a custom Terraform provider that includes API actions designed to interact with Terraform resources. Can you confirm, so I provide you with requirements.
‚Äî
Requirements:</p>

<p>We aim to perform the following actions;</p>
<ol>
  <li>GET /api/u/:user_uuid/home</li>
  <li>POST /api/u/:user_uuid/home</li>
  <li>PUT /api/u/:user_uuid/home</li>
  <li>DELETE /api/u/:user_uuid/home
```</li>
</ol>

<h4 id="importing-in-go">Importing in Go</h4>
<p>To import multiple packages in Go, you can use the following syntax:</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
    <span class="s">"package1"</span>
    <span class="s">"package2"</span>
    <span class="c">// Add more packages here</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="plugin-setup">Plugin Setup</h3>

<p>We‚Äôll need to set up a plugin server for our provider exactly why we coded the ruby server.</p>

<ol>
  <li>In the <code class="language-plaintext highlighter-rouge">main</code> function add our custom provider.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="n">plugin</span><span class="o">.</span><span class="n">Serve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">plugin</span><span class="o">.</span><span class="n">ServeOpts</span><span class="p">{</span>
     <span class="n">ProviderFunc</span><span class="o">:</span> <span class="n">Provider</span><span class="p">,</span>
 <span class="p">})</span>
</code></pre></div>    </div>
  </li>
  <li>Below the <code class="language-plaintext highlighter-rouge">main</code> function, specify the provider as a function.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">Provider</span><span class="p">()</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Provider</span> <span class="p">{}</span>
</code></pre></div>    </div>
  </li>
</ol>

<ul>
  <li>A function in go is just func</li>
  <li>Go doesn‚Äôt use classes; instead, it relies on interfaces.</li>
</ul>

<p>We used the <code class="language-plaintext highlighter-rouge">developer.hashicorp.com</code> Terraform provider setup tutorial for this.</p>

<ol>
  <li>Retrieve the link from the <code class="language-plaintext highlighter-rouge">main.go</code> file and incorporate it into our schema.</li>
  <li>Code the function and add the following;
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">var</span> <span class="n">p</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Provider</span>
 <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">schema</span><span class="o">.</span><span class="n">Provider</span><span class="p">{</span>
</code></pre></div>    </div>
  </li>
  <li>Create the provider schema
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">schema</span><span class="o">.</span><span class="n">Provider</span><span class="p">{}</span>
</code></pre></div>    </div>
  </li>
  <li>Define the resource and data sources map inside p;
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="n">ResourcesMap</span><span class="o">:</span>  <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Resource</span><span class="p">{</span>

     <span class="p">},</span>
     <span class="n">DataSourcesMap</span><span class="o">:</span>  <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Resource</span><span class="p">{</span>

     <span class="p">},</span>
</code></pre></div>    </div>
  </li>
  <li>Include the necessary elements for the schema incl <code class="language-plaintext highlighter-rouge">endpoint</code>, <code class="language-plaintext highlighter-rouge">user_uuid</code> and <code class="language-plaintext highlighter-rouge">token</code>.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="n">Schema</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Schema</span><span class="p">{</span>
         <span class="s">"endpoint"</span><span class="o">:</span> <span class="p">{</span>
             <span class="n">Type</span><span class="o">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">TypeString</span><span class="p">,</span>
             <span class="n">Required</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
             <span class="n">Description</span><span class="o">:</span> <span class="s">"The endpoint for hte external service"</span><span class="p">,</span>
         <span class="p">},</span>
         <span class="s">"token"</span><span class="o">:</span> <span class="p">{</span>
             <span class="n">Type</span><span class="o">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">TypeString</span><span class="p">,</span>
             <span class="n">Sensitive</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span> <span class="c">// make the token as sensitive to hide it the logs</span>
             <span class="n">Required</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
             <span class="n">Description</span><span class="o">:</span> <span class="s">"Bearer token for authorization"</span><span class="p">,</span>
         <span class="p">},</span>
         <span class="s">"user_uuid"</span><span class="o">:</span> <span class="p">{</span>
             <span class="n">Type</span><span class="o">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">TypeString</span><span class="p">,</span>
             <span class="n">Required</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
             <span class="n">Description</span><span class="o">:</span> <span class="s">"UUID for configuration"</span><span class="p">,</span>
             <span class="c">//ValidateFunc: validateUUID,</span>
         <span class="p">},</span>
     <span class="p">},</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Code validateFunc like a pro by adding it like this;
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validateFunc</span><span class="o">:=</span> <span class="n">validateUUID</span>
</code></pre></div>    </div>
  </li>
  <li>Request GPT to generate the code for it.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Can you fill the validate UUID function for me?

Nah.

Okay np.
</code></pre></div></div>
<ol>
  <li>
    <p>Google provides its own library at github.com/google/uuid, which offer a solution for validation.</p>
  </li>
  <li>Use this <a href="https://stackoverflow.com/questions/25051675/how-to-validate-uuid-v4-in-go">stackoverflow refernce</a> for more about validation.</li>
  <li>Get the prompt from GPT and lets tweak it baby.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">validateUUID</span><span class="p">(</span><span class="n">v</span> <span class="k">interface</span><span class="p">{},</span> <span class="n">k</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="n">ws</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">errors</span> <span class="p">[]</span><span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="err">'</span><span class="n">validateUUID</span><span class="o">:</span><span class="n">start</span><span class="err">'</span><span class="p">)</span>
<span class="n">value</span> <span class="o">:=</span> <span class="n">v</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span>
<span class="k">if</span> <span class="n">_</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="kt">error</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"invalid UUID format"</span><span class="p">))</span>
<span class="p">}</span>
<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="err">'</span><span class="n">validateUUID</span><span class="o">:</span><span class="n">end</span><span class="err">'</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Great and cool. Now we have to look how to make this run.</p>

<h3 id="complie-your-custom-provider">Complie Your Custom Provider</h3>

<p>To compile a custom provider, you need a <code class="language-plaintext highlighter-rouge">terraformrc</code> file.</p>

<p>Terraform maintains a hidden directory called <code class="language-plaintext highlighter-rouge">.terraform.d</code> with a <code class="language-plaintext highlighter-rouge">plugins</code> folder to store plugin binaries.</p>

<p>Ensure that you have a local provider directory where you place the binary files generated.</p>

<ol>
  <li>Run the following command to build the custom provider binary:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go build -o terraform-provider-terratowns-v1.0.0
</code></pre></div></div>

<ol>
  <li>Test the custom provider using the <code class="language-plaintext highlighter-rouge">.terraformrc</code> file.</li>
  <li>Create a <code class="language-plaintext highlighter-rouge">terraformrc</code> file at the root of your project.</li>
</ol>

<p>Ensure that the file name does not contain a period as it should be placed within your custom provider code. (We will use cp command.)</p>

<p>Inside the <code class="language-plaintext highlighter-rouge">terraformrc</code> file, add the following configuration for provider installation:</p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">provider_installation</span> <span class="p">{</span>
  <span class="nx">filesystem_mirror</span> <span class="p">{</span>
    <span class="nx">path</span> <span class="p">=</span> <span class="s2">"/home/gitpod/.terraform.d/plugins"</span>
    <span class="nx">include</span> <span class="p">[</span><span class="s2">"local.providers/*/*"</span><span class="p">]</span>
  <span class="p">}</span> 
  <span class="nx">direct</span> <span class="p">{</span>
   <span class="nx">exclude</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"local.providers/*/*"</span><span class="p">]</span> 
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Also..building the binary can be challenging (was really hard..)</p>

<blockquote>
  <p>Thanks to Jason for <a href="https://servian.dev/terraform-local-providers-and-registry-mirror-configuration-b963117dfffa?gi=06e845629b10">this article.</a></p>
</blockquote>

<p>A script-based approach is recommended:</p>

<ol>
  <li>Navigate to the <code class="language-plaintext highlighter-rouge">bin</code> directory.</li>
  <li>Create a file named <code class="language-plaintext highlighter-rouge">build_provider</code> and add the necessary content to build the binary.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm -rf ~/.terraform.d/plugins
rm -rf $PROJECT_ROOT/.terraform
rm -rf $PROJECT_ROOT/.terraform.lock.hcl
</code></pre></div>    </div>
    <p>We started by removing previous dependencies in case.</p>
  </li>
  <li>Create both compute env, once for each chipset on the target compute
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkrdir <span class="nt">-p</span> ~/.terraform.d/plugins/local.providers/local/terratowns/1.0.0//x86_64/
mkrdir <span class="nt">-p</span> ~/.terraform.d/plugins/local.providers/local/terratowns/1.0.0//linux_amd64/
</code></pre></div>    </div>
  </li>
</ol>

<blockquote>
  <p>This ensures compatibility with what yours may be using.</p>
</blockquote>

<p>Now make use of environment variables in your script to simplify the build process.</p>

<ol>
  <li>Apply the environment variables for your plugin path.</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">PLUGIN_DIR</span><span class="o">=</span><span class="s2">"~/.terraform.d/plugins/local.providers/local/terratowns/1.0.0/"</span>

mkrdir <span class="nt">-p</span> <span class="nv">$PLUGIN_DIR</span>/x86_64/
mkrdir <span class="nt">-p</span> <span class="nv">$PLUGIN_DIR</span>/linux_amd64/
</code></pre></div></div>

<ol>
  <li>Apply the environment variables for your plugin name and copy it.</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">PLUGIN_NAME</span><span class="o">=</span><span class="s2">"terraform-provider-terratowns_v1.0.0"</span>

<span class="nb">cp</span> <span class="nv">$PLUGIN_NAME</span> <span class="nv">$PLUGIN_DIR</span>/x86_64
<span class="nb">cp</span> <span class="nv">$PLUGIN_NAME</span> <span class="nv">$PLUGIN_DIR</span>/linux_amd64
</code></pre></div></div>

<p>First, <a href="bin/build_provider">Verify the script from here right away.</a></p>

<p>Second. We can‚Äôt build this yet<br />To really build the provider <strong>we need something else.</strong></p>

<h3 id="modgo-is-a-must"><code class="language-plaintext highlighter-rouge">mod.go</code> Is A Must</h3>

<p>You need to ensure you have a <code class="language-plaintext highlighter-rouge">go.mod</code> file.</p>

<ol>
  <li>Create a file named go.mod and add the necessary content.</li>
  <li>Add  repo URL as The module and the version.</li>
</ol>

<pre><code class="language-mod">module github.com/ExamProCo/terraform-provider-terratowns
go 1.20
</code></pre>
<ol>
  <li>Important to Map the repo URL to the path of your workspace.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>replace github.com/ExamProCo/terraform-provider-terratowns <span class="o">=&gt;</span> /workspace/terraform-beginner-bootcamp-2023/terraform-provider-terratowns
</code></pre></div>    </div>
  </li>
  <li>Add an open require  for what we will need.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require ()
</code></pre></div>    </div>
  </li>
</ol>

<p>Now we are ready for the build and further troubleshoot.</p>

<h3 id="real-build-check">Real Build Check</h3>

<ol>
  <li>Run the build script.</li>
</ol>

<table>
  <thead>
    <tr>
      <th>You will get an error about a missing import path.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Correct it by ensuring proper use of parentheses in your import statements.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>It is <code class="language-plaintext highlighter-rouge">()</code> and not <code class="language-plaintext highlighter-rouge">{}</code></p>
</blockquote>

<ol>
  <li>Build again</li>
</ol>

<p>You are now being asked to get the github repos required.</p>

<ol>
  <li>Run go get to fetch any required GitHub repositories as indicated by the error message.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go get github-url-lib
</code></pre></div>    </div>
  </li>
</ol>

<p><img src="/assets/2.1.0/go-get-it.png" alt="Go Get It Boi" /></p>

<p>This installs the latest version of the module.</p>

<ol>
  <li>Building again result in a new <code class="language-plaintext highlighter-rouge">go.sum</code> file.</li>
</ol>

<p>The go.mod file now includes more URL paths, which you didn‚Äôt have to manually write.</p>

<ol>
  <li>Building again.. also know that the first time may be slow due to dependency downloads.</li>
</ol>

<p>You might encounter errors during this build process number too much.. <br />
The provider schema declaration is to replace <code class="language-plaintext highlighter-rouge">.Resources{</code> with <code class="language-plaintext highlighter-rouge">.Schema{.</code><br />
Also add the comma..</p>

<p><strong>This is not ruby.</strong></p>

<p>Continue building and address any unused log errors.</p>

<ol>
  <li>Remove or uncomment the log from the import in your <code class="language-plaintext highlighter-rouge">main.go</code>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">// "log"</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>Finally, after a successful build.<br />
You will find the <code class="language-plaintext highlighter-rouge">terraform-provider-terratowns-v1.0.0</code> binary.</p>
<blockquote>
  <p>This is so wrong. <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tree/53-terratowns-block#connecting-dots-and-traps">You‚Äôll find out</a> next release. We had traps.</p>
</blockquote>

<p><img src="/assets/2.1.0/go-the-bin.png" alt="Binairy Is Here Baby" /></p>

<p>It can be quite large, so consider the following;</p>

<ol>
  <li>Observe the <code class="language-plaintext highlighter-rouge">go.sum</code> file and <a href="terraform-provider-terratowns/go.sum">all the dependencies here</a>.</li>
  <li>Add your binairy to your <code class="language-plaintext highlighter-rouge">.gitignore</code>.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ignore Terratowns Custom Provider Binairies All versions</span>
terraform-provider-terratowns/terraform-provider-terratowns_v<span class="k">*</span>
</code></pre></div>    </div>
    <p>This file now won‚Äôt be comitted and  will be avoided by your version control!</p>
  </li>
</ol>

<h4 id="considerations">Considerations</h4>
<ul>
  <li>The subsequent builds but the first should be faster.</li>
  <li>The binary file for your provider can be large (e.g., 20MB).</li>
  <li>Use <code class="language-plaintext highlighter-rouge">.gitignore</code> file to exclude it from version control.</li>
</ul>

<p>Creating a custom Terraform provider can be a complex process<br />This starts the process of generating the actual binary which is also the Skeleton For our Terratowns!</p>

<p>If it is building for you, You are in a good shape for <code class="language-plaintext highlighter-rouge">2.2.0</code> !</p>

<h1 id="terratowns-terraform-block">Terratowns Terraform Block</h1>

<p>Welcome to <code class="language-plaintext highlighter-rouge">2.2.0</code> our second part for working with the creation of our custom provider.</p>
<ul>
  <li><a href="#connecting-dots-and-traps">Connecting Dots And Traps</a></li>
  <li><a href="#configuring-the-custom-provider-block">Configuring the Custom Provider Block</a></li>
  <li><a href="#rebuilding-the-provider-after-your-code">Rebuilding the Provider After Your Code</a></li>
  <li><a href="#idea-on-the-way">Idea On The Way</a></li>
  <li><a href="#back-to-plan">Back To Plan</a></li>
</ul>

<p>To get the most of this, I highly encourage you refer to the issues we dealt with for Terratowns <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/issues/51">starting with this.</a></p>

<h2 id="connecting-dots-and-traps">Connecting Dots And Traps</h2>

<p>We have our plugin ready from previous tag. <br />Let‚Äôs rebuild the binary.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div></div>

<p>There is build errors. An issue occurred while attempting to set <code class="language-plaintext highlighter-rouge">terraformrc</code>.</p>
<ul>
  <li>There was a mistakenly executed <code class="language-plaintext highlighter-rouge">mkdir</code> command.</li>
  <li>add an <code class="language-plaintext highlighter-rouge">=</code> between <code class="language-plaintext highlighter-rouge">include</code> and <code class="language-plaintext highlighter-rouge">["local.providers/*/*"]</code> in terraformrc`.</li>
</ul>

<p>Double execute the script and it should now work fine, this generates;</p>
<ul>
  <li>The binary which is what we want.</li>
  <li>Another folder that starts with a tilde <code class="language-plaintext highlighter-rouge">(~)</code>, terminate it.</li>
</ul>

<p>If you back to my previous branch, you should notice that I got that and left it for reference.</p>

<ul>
  <li>In the script replace <code class="language-plaintext highlighter-rouge">(~)</code> with <code class="language-plaintext highlighter-rouge">/home/gitpod</code>.</li>
  <li>Correct <code class="language-plaintext highlighter-rouge">PROJET_ROOT</code> with <code class="language-plaintext highlighter-rouge">PROJECT_ROOT</code>.</li>
  <li>Change the second <code class="language-plaintext highlighter-rouge">(~)</code> in <code class="language-plaintext highlighter-rouge">rm -rf</code> to  <code class="language-plaintext highlighter-rouge">/home/gitpod</code>.</li>
</ul>

<p>|Please correct the script by updating the path for the ‚Äòplugin_dir‚Äô variable|
|‚Äî|</p>

<p>These corrections eliminated errors, resulting in the successful generation of the binary.</p>

<ul>
  <li><strong>To confirm the binary was generated</strong><br />
<strong>Check it in <code class="language-plaintext highlighter-rouge">terraform-provider-terratowns</code>.</strong></li>
</ul>

<p><img src="/assets/2.2.0/recover-binary-built.png" alt="HERE IS IT BinBaby!" /></p>

<p>Now that our library is configured, it‚Äôs time to integrate it with our Terraform setup. This corresponds to version <code class="language-plaintext highlighter-rouge">2.2.0</code> of our project.</p>

<h2 id="configuring-the-custom-provider-block">Configuring the Custom Provider Block</h2>
<p>The next step is to configure the custom provider within Terraform:</p>

<ol>
  <li>Update  <code class="language-plaintext highlighter-rouge">main.tf</code> file to specify the Terraform block with our provider.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">required_providers</span> <span class="p">{</span>
 <span class="nx">terratowns</span> <span class="p">=</span> <span class="p">{</span>
   <span class="nx">source</span> <span class="p">=</span> <span class="s2">"local.providers/local/terratowns"</span>
   <span class="nx">version</span> <span class="p">=</span> <span class="s2">"1.0.0"</span>
 <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Below the Terraform block, create the provider block itself.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"terratowns"</span> <span class="p">{</span>
 <span class="nx">what</span> <span class="nx">is</span> <span class="nx">next</span> <span class="nx">goes</span> <span class="nx">here</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Specify the required the endpoint, service UUID, and token.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">endpoint</span> <span class="err">=</span> <span class="s2">"http://localhost:4567"</span>
  <span class="nx">user_uuid</span><span class="err">=</span><span class="s2">"get-it-from-teacherseat-profile"</span>
  <span class="nx">token</span><span class="err">=</span><span class="s2">"get-it-from-teacherseat-settings"</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>The required UUID and token values were obtained from a mock created by the script.</p>

<p>Later this will both come from the ExamPro Platform. (It is already there)</p>

<h3 id="rebuilding-the-provider-after-your-code">Rebuilding the Provider After Your Code</h3>
<ol>
  <li>
    <p>Build our provider again to get an updated binary.</p>
  </li>
  <li>
    <p>Initialize Terraform, and execute <code class="language-plaintext highlighter-rouge">terraform init</code>.</p>
  </li>
</ol>

<table>
  <thead>
    <tr>
      <th>‚ùå ERROR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>An error occurred during initialization due to a missing include.</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>The build script was executed again, followed by <code class="language-plaintext highlighter-rouge">terraform init</code>.</li>
</ol>

<p>This now resolves our issue.</p>

<h3 id="idea-on-the-way">Idea On The Way</h3>
<p>When you perform actions like that, having different log levels in place can greatly simplify the process.</p>

<p>Effective logging can make troubleshooting easier. In this release, log levels were configured for debugging purposes:</p>

<ol>
  <li>Add the log level using the command
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TF_LOG=DEBUG tf init
</code></pre></div>    </div>
  </li>
  <li>Enable Debug mode was in the environment configuration within the Terraform block in GitPod file.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasks:
  - name: terraform
 env:
   TF_LOG: DEBUG
</code></pre></div>    </div>
  </li>
</ol>

<p>We can now debug and get good stuff.</p>

<p>When things go awry in our Go code, these logs will prove invaluable for troubleshooting.
This verbose mode is great idea.</p>

<h2 id="back-to-plan">Back To Plan</h2>

<p>We stopped at the init, where we resolved our issue.</p>

<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">tf plan</code> to quickstart our code.</li>
</ol>

<p><img src="/assets/2.2.0/comment-outputs.png" alt="Plan Error Outputs" /></p>

<p>To ensure that the changes made were effective, the following steps were taken:</p>

<ul>
  <li>Make sure module blocks were commented to avoid interference.</li>
  <li>Make sure all output lines in the root also.</li>
</ul>

<p>|tf plan will <a href="/assets/2.2.0/planned-as-required.png">now work</a> with No changes. Your infrastructure matches the configuration.|
|‚Äî|</p>
<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform apply</code> or just <code class="language-plaintext highlighter-rouge">tfaa</code> again to push our code with auto approve using our <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tree/35-s3-static-website-host#bonus-three-captured">previous configured alias</a>.</li>
</ol>

<p>Things are working great now!</p>

<p><img src="/assets/2.2.0/apply-done.png" alt="Apply Success With Zero Resource" /></p>

<table>
  <thead>
    <tr>
      <th>Applying the configuration will produce an empty Terraform state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>This is actually a positive and desired outcome</td>
    </tr>
  </tbody>
</table>

<h4 id="good-stuff">Good Stuff!</h4>
<p>Version <code class="language-plaintext highlighter-rouge">2.2.0</code> of the TerraTown Provider saw improvements in the build script, custom provider configuration, debugging capabilities, and error resolution.</p>

<p>We‚Äôre also introducing the Terraform block for our new custom provider, ensuring its functionality.</p>

<p><code class="language-plaintext highlighter-rouge">2.3.0</code> is our final step and will involve a more in-depth exploration of Go and the coding of the actual resources for our provider.</p>

<h1 id="terratowns-resource-skeleton">TerraTowns Resource Skeleton</h1>

<p>In the previous setup <code class="language-plaintext highlighter-rouge">2.2.0</code>, we did not define any resources for our provider but layed the required to do so!</p>

<p>Now, let‚Äôs begin with the creation of a <code class="language-plaintext highlighter-rouge">2.3.0</code> Resource Skeleton. <br />
We‚Äôll create a basic structure for a new resource and introduce some Go programming concepts along the way.</p>
<ul>
  <li><a href="#preparing-and-energizing">Preparing and Energizing</a></li>
  <li><a href="#writing-provider-configuration">Writing Provider Configuration</a></li>
  <li><a href="#setting-up-a-resource">Setting Up a Resource</a></li>
  <li><a href="#production-considerations">Production Considerations</a></li>
</ul>

<p>The next <code class="language-plaintext highlighter-rouge">2.4.0</code> is where we will actually go and fill those cruds as per our requirements in go.</p>

<h3 id="preparing-and-energizing">Preparing and Energizing</h3>
<p>Take note of the extensions you‚Äôll need, such as Go and Golang tools.</p>
<ol>
  <li>Before all, uncomment the validator in your <code class="language-plaintext highlighter-rouge">main.go</code> code if you didn‚Äôt remove it.</li>
</ol>

<p>I did cause I want my code neat. <br /><a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/blob/2.4.0/terraform-provider-terratowns/main.go">Take a look.</a> <br />
I coded it again.</p>

<ol>
  <li>
    <p>Add 	<code class="language-plaintext highlighter-rouge">ValidateFunc: validateUUID</code>, to your schema uuid block.</p>
  </li>
  <li>Also re-enable logging.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import ("log")
</code></pre></div>    </div>
  </li>
  <li>Also, ensure that you are working within the Terraform tab,</li>
</ol>

<p>We have set up debugging for this context.</p>

<ol>
  <li>build our provider to see, you may encounter errors.</li>
  <li>Replace single quotes (<code class="language-plaintext highlighter-rouge">''</code>) with double quotes (<code class="language-plaintext highlighter-rouge">""</code>) for the func validator.</li>
  <li>Build again; if you encounter errors, include ‚Äògoogle‚Äô in the import statement for ‚Äòuuid‚Äô lib.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>github.com/google/uuid v1.3.0
</code></pre></div>    </div>
  </li>
  <li>Use <code class="language-plaintext highlighter-rouge">go get</code> to fetch dependencies from the specified GitHub URL</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/terraform-provider-terratowns (55-terratowns-cruds) 
$ go get github.com/google/uuid

go: upgraded github.com/google/uuid v1.3.0 =&gt; v1.3.1
</code></pre></div></div>
<blockquote>
  <p>Make sure you are inside the correct directory.</p>
  <ol>
    <li>Return to the our directory and build again or stay..
You may encounter more errors;
      <ul>
        <li>If related to <code class="language-plaintext highlighter-rouge">append</code>, adjust the error handling to <code class="language-plaintext highlighter-rouge">errors</code></li>
        <li>If related to missing returns, make sure to add them as needed.</li>
      </ul>
    </li>
  </ol>
</blockquote>

<p>In some cases, returning <code class="language-plaintext highlighter-rouge">true</code> may be necessary, but <code class="language-plaintext highlighter-rouge">return</code> alone can work effectively.</p>

<p>Keep in mind that building providers in Go can be complex, and it‚Äôs okay if you‚Äôre just starting to get the hang of it.</p>

<ol>
  <li>Go build again, and should work fine now.</li>
</ol>

<p><img src="/assets/2.3.0/first-build-success-for-this-branch.png" alt="First Build Worked Here" /></p>

<ol>
  <li>Proceed with <code class="language-plaintext highlighter-rouge">terterraform init</code>.</li>
</ol>

<p>You should see logs indicating a successful initialization.</p>

<p><img src="/assets/2.3.0/logs-enabled-tf-cli-tab.png" alt="Logs Enabled in Terraform Tab" /></p>

<ol>
  <li>run <code class="language-plaintext highlighter-rouge">tf plan</code> and observe
    <ul>
      <li>No errors found!</li>
      <li>No infrastructure changes!
```
2023-10-05T21:52:23.756Z [INFO]  backend/local: plan operation completed</li>
    </ul>
  </li>
</ol>

<p>No changes. Your infrastructure matches the configuration.</p>

<p>Terraform has compared your real infrastructure against your configuration and found no
differences, so no changes are needed.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This is expected at this stage aka **back to black!**


## Writing Provider Configuration

Create a `providerConfigure` function.&lt;br&gt; We will start by writing some initial code.


```go
func providerConfigure(p *schema.Provider) schema.ConfigureContextFunc {
}
</code></pre></div></div>

<ol>
  <li>Add the return func nested within;
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">return</span> <span class="k">func</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">d</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">ResourceData</span><span class="p">)</span> <span class="p">(</span><span class="k">interface</span><span class="p">{},</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span> <span class="p">)</span> <span class="p">{</span>
 <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Add the Config for <code class="language-plaintext highlighter-rouge">endpoint</code>, <code class="language-plaintext highlighter-rouge">token</code> and <code class="language-plaintext highlighter-rouge">uuid</code>;
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     <span class="n">config</span> <span class="o">:=</span> <span class="n">Config</span><span class="p">{</span>
         <span class="n">Endpoint</span><span class="o">:</span> <span class="n">d</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"endpoint"</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span>
         <span class="n">Token</span><span class="o">:</span> <span class="n">d</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"token"</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span>
         <span class="n">UserUuid</span><span class="o">:</span> <span class="n">d</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"user_uuid"</span><span class="p">)</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="o">&amp;</span><span class="n">config</span><span class="p">,</span> <span class="no">nil</span>
</code></pre></div>    </div>
  </li>
  <li>Fix two prints to help in the debug;</li>
</ol>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">// Before Config</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"providerConfigure:start"</span><span class="p">)</span>
    <span class="c">// Before Return</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"providerConfigure:end"</span><span class="p">)</span>
</code></pre></div></div>
<ol>
  <li>Add or uncomment if the following line before returnig <code class="language-plaintext highlighter-rouge">p</code> in provider schema func;
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">p</span><span class="o">.</span><span class="n">ConfigureContextFunc</span> <span class="o">=</span> <span class="n">providerConfigure</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Rebuild</strong> the provider after adding the <code class="language-plaintext highlighter-rouge">providerConfigure</code> function.</li>
</ol>

<p>you may encounter errors related to undefined elements.</p>

<ol>
  <li>To fix that, <strong>Import More Dependencies</strong>
    <ul>
      <li>Import <code class="language-plaintext highlighter-rouge">diag</code>, <code class="language-plaintext highlighter-rouge">context</code> packages.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 	<span class="k">import</span> <span class="p">(</span>
  <span class="s">"context"</span>
  <span class="s">"github.com/hashicorp/terraform-plugin-sdk/v2/diag"</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>For config, Define your own structure for the configuration after the <code class="language-plaintext highlighter-rouge">import</code>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Config</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Endpoint</span> <span class="kt">string</span>
  <span class="n">Token</span> <span class="kt">string</span>
  <span class="n">UserUuid</span> <span class="kt">string</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<p><img src="/assets/2.3.0/worked-poc.png" alt="Dependencies Working!" /></p>

<p>We are all set, lets setup our resource.</p>

<h3 id="setting-up-a-resource">Setting Up a Resource</h3>
<p>Next, we‚Äôll set up a resource for the provider. We will define our Cruds and code these actions as separate functions.</p>

<p>While we could create separate files for this, we‚Äôll keep everything together for readability your ease of learn.</p>

<ol>
  <li><strong>Modify Provider Schema</strong>
    <ul>
      <li>In the provider schema (provider.pro), add the resource name <code class="language-plaintext highlighter-rouge">terrtowns_home</code>.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">ResourcesMap</span><span class="o">:</span>  <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Resource</span><span class="p">{</span>
<span class="c">// added the following:</span>
      <span class="s">"terratowns_home"</span><span class="o">:</span> <span class="n">Resource</span><span class="p">(),</span>
  <span class="p">},</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Resource Functions</strong></li>
</ol>

<p>Define the four basic CRUD actions for your resource block;</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">Resource</span><span class="p">()</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">Resource</span> <span class="p">{</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Resource:start"</span><span class="p">)</span>
	<span class="n">resource</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">schema</span><span class="o">.</span><span class="n">Resource</span><span class="p">{</span>
		<span class="n">CreateContext</span><span class="o">:</span> <span class="n">resourceHouseCreate</span><span class="p">,</span>
		<span class="n">ReadContext</span><span class="o">:</span> <span class="n">resourceHouseRead</span><span class="p">,</span>
		<span class="n">UpdateContext</span><span class="o">:</span> <span class="n">resourceHouseUpdate</span><span class="p">,</span>
		<span class="n">DeleteContext</span><span class="o">:</span> <span class="n">resourceHouseDelete</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Resource:start"</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">resource</span>
<span class="p">}</span>
</code></pre></div></div>
<p>These actions are standard for every resource in a Terraform provider. 
We have to code a func  skeleton for each.</p>

<p><strong>Starting with the create;</strong></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">resourceHouseCreate</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">d</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">ResourceData</span><span class="p">,</span> <span class="n">m</span> <span class="k">interface</span><span class="p">{})</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">diags</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span>
	<span class="k">return</span> <span class="n">diags</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Proceed to the read;</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">resourceHouseRead</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">d</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">ResourceData</span><span class="p">,</span> <span class="n">m</span> <span class="k">interface</span><span class="p">{})</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">diags</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span>
	<span class="k">return</span> <span class="n">diags</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Advance to the update;</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">resourceHouseUpdate</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">d</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">ResourceData</span><span class="p">,</span> <span class="n">m</span> <span class="k">interface</span><span class="p">{})</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">diags</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span>
	<span class="k">return</span> <span class="n">diags</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Wrap the skeleton with delete;</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">resourceHouseDelete</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">d</span> <span class="o">*</span><span class="n">schema</span><span class="o">.</span><span class="n">ResourceData</span><span class="p">,</span> <span class="n">m</span> <span class="k">interface</span><span class="p">{})</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">diags</span> <span class="n">diag</span><span class="o">.</span><span class="n">Diagnostics</span>
	<span class="k">return</span> <span class="n">diags</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li><strong>Build Again</strong>
    <ul>
      <li>Rebuild the provider after defining these functions.
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Fix Errors</strong></li>
</ol>

<p>Address any issue encountered during this build process;</p>

<ul>
  <li>Ensure that interface definitions are in <code class="language-plaintext highlighter-rouge">{}</code> and not <code class="language-plaintext highlighter-rouge">()</code>. and</li>
  <li>Ensure there is no missing as missing commas.</li>
  <li>Ensure you return the resource in the main function for all actions.</li>
</ul>

<ol>
  <li><strong>Build Again</strong>
    <ul>
      <li>Rebuild the provider one more time to ensure everything is working as expected.</li>
    </ul>
  </li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./bin/build_provider  
</code></pre></div></div>
<p>After these steps, you should have empty functions in place. This marks the completion of the skeleton setup.</p>

<blockquote>
  <p>These are now coded, built again and pushed to the branch.</p>
</blockquote>

<p>Everything later will come into a place in week-2-perfecting.</p>

<h4 id="production-considerations">Production Considerations</h4>
<p>In a real project, you wouldn‚Äôt commit and create pull requests for these changes; <br />They would typically remain in a feature branch until the entire job is finished.</p>

<p>In the next phase and last, we‚Äôll start filling in the resource and making the API calls.</p>

<p>|OpenAI plugins are great stuff|
|:‚Äî:|</p>

<h1 id="terratowns-home-resource">TerraTowns <code class="language-plaintext highlighter-rouge">Home</code> Resource</h1>
<p>We welcome you in this last and intense <code class="language-plaintext highlighter-rouge">4/4</code> part of our custom terraform provider creation.</p>

<ul>
  <li><a href="#code-the-terraform-resource">Code the Terraform Resource</a></li>
  <li><a href="#building-and-initializing">Building and Initializing</a></li>
  <li><a href="#code-implementation">Code Implementation</a></li>
  <li><a href="#payload-processing-and-error-handling-in-api-requests">Payload Processing in API Requests</a></li>
  <li><a href="#testing">Testing and State</a></li>
</ul>

<p>We will start by defining the schema for our resource.</p>

<p>I want to call it home resource. <br />But since its the only resource.. <br />We call it just resource.</p>

<p>Remember it is still our home üòä</p>

<h3 id="compiling-the-code">Compiling the Code</h3>
<p>To check if everything compiles correctly first, run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/build_provider
</code></pre></div></div>
<h2 id="code-the-terraform-resource">Code the Terraform Resource</h2>

<ol>
  <li>Go to the <code class="language-plaintext highlighter-rouge">main.tf</code> file at the root level.</li>
  <li>Add a new Terraform resource named <code class="language-plaintext highlighter-rouge">terrtown_home</code> and name it <code class="language-plaintext highlighter-rouge">home</code>.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">resource</span> <span class="s2">"terratown_home"</span> <span class="s2">"home"</span> <span class="p">{}</span>
</code></pre></div>    </div>
  </li>
  <li>Start with Including the <code class="language-plaintext highlighter-rouge">name</code>  attributes.
    <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">name</span> <span class="err">=</span> <span class="s2">"Secrets are at the core of successful businesses"</span>
</code></pre></div>    </div>
  </li>
</ol>

<blockquote>
  <p>Where <a href="https://www.amazon.com/Zero-One-Notes-Startups-Future/dp/0804139296">I read that quote?</a></p>
</blockquote>

<ol>
  <li>choose where you want to put your page e.g.; <code class="language-plaintext highlighter-rouge">gamers-groto</code> for <code class="language-plaintext highlighter-rouge">town</code>.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">town</span> <span class="err">=</span> <span class="s2">"gamers-grotto"</span>
</code></pre></div>    </div>
  </li>
  <li>Use the <code class="language-plaintext highlighter-rouge">&lt;&lt; &gt;&gt;</code> syntax to configure the description, similar to EOF.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">description</span> <span class="err">=</span> <span class="o">&lt;&lt;</span><span class="no">DESCRIPTION</span><span class="sh">
Something so great and innovative.
Something Amazing.
As great as you.
</span><span class="no">DESCRIPTION
</span></code></pre></div>    </div>
  </li>
  <li>Retrieve the domain name from your other project (CloudFront URL)</li>
  <li>set the domain_name as an output.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>domain_name = "very-random.cloudfront.net"
</code></pre></div></div>
<ol>
  <li>Specify the content_version starting with one;
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>content_version = 1
</code></pre></div>    </div>
    <h2 id="building-and-initializing">Building and Initializing</h2>
    <p>Run the following commands to prepare your Terraform environment:</p>
  </li>
  <li>Run <code class="language-plaintext highlighter-rouge">terraform init</code></li>
</ol>

<p><strong>ERROR:</strong> <code class="language-plaintext highlighter-rouge">failed to query available provider packages</code></p>

<ol>
  <li>review your Terraform configuration files include terraformrc.</li>
</ol>

<p>Everything looks fine..<br />We didnt finish anything with the code.. <br />We still have empty resources in <code class="language-plaintext highlighter-rouge">main.go</code> it may be why..</p>

<p>Lets keep coding and see.</p>

<h2 id="code-implementation">Code Implementation</h2>
<p>Next, we need to code the CRUD (Create, Read, Update, Delete) operations for our resource.</p>

<h3 id="create-action">Create Action</h3>
<ul>
  <li>Implement the HTTP request and endpoint for creating a resource.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">req</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"POST"</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">Endpoint</span><span class="o">+</span><span class="s">"/u/"</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">UserUuid</span><span class="o">+</span><span class="s">"/homes"</span><span class="p">,</span> <span class="n">bytes</span><span class="o">.</span><span class="n">NewBuffer</span><span class="p">(</span><span class="n">payloadBytes</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Add authorization and your bearer token to the create request.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">"Bearer "</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Set headers for content type and accept.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
  <span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Accept"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Ensure that you handle any errors and parse the response.
```go
if err != nil {
 return diag.FromErr(err)
}
defer resp.Body.Close()</li>
</ul>

<p>// parse response JSON
var responseData map[string]interface{}
if err := json.NewDecoder(resp.Body).Decode(&amp;responseData);  err != nil {
   return diag.FromErr(err)
}</p>

<p>// StatusOK = 200 HTTP Response Code
if resp.StatusCode != http.StatusOK {
   return diag.FromErr(fmt.Errorf(‚Äúfailed to create home resource, status_code: %d, status: %s, body %s‚Äù, resp.StatusCode, resp.Status, bytes.NewBuffer(responseData)))
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Return the `homeUUID` from the response and set it using `d.Set`.
```go
homeUUID := responseData["uuid"].(string)
d.SetId(homeUUID)
</code></pre></div></div>

<ul>
  <li>Add print at the start for debugging purposes
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"resourceHouseCreate:start"</span><span class="p">)</span>
</code></pre></div>    </div>
    <h3 id="read-action">Read Action</h3>
  </li>
  <li>Implement the HTTP GET request for reading a resource.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">req</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">Endpoint</span><span class="o">+</span><span class="s">"/u/"</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">UserUuid</span><span class="o">+</span><span class="s">"/homes/"</span><span class="o">+</span><span class="n">homeUUID</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
 <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Pass the <code class="language-plaintext highlighter-rouge">homeUUID</code> in the URL.</li>
  <li>Set the headers for the read func
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">"Bearer "</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Accept"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Parse the response data and return it.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">client</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">Client</span><span class="p">{}</span>
  <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>    </div>
    <p>Consider the code to handle errors gracefully. <br />(Coming below)</p>
    <h3 id="update-action">Update Action</h3>
  </li>
  <li>Implement the HTTP request for updating a resource.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">req</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="s">"PUT"</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">Endpoint</span><span class="o">+</span><span class="s">"/u/"</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">UserUuid</span><span class="o">+</span><span class="s">"/homes/"</span><span class="o">+</span><span class="n">homeUUID</span><span class="p">,</span> <span class="n">bytes</span><span class="o">.</span><span class="n">NewBuffer</span><span class="p">(</span><span class="n">payloadBytes</span><span class="p">))</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="kt">error</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Set the header for the update
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">"Bearer "</span><span class="o">+</span><span class="n">config</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span>
  <span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
  <span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"Accept"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Use the payload from the create action but exclude domain and town.</li>
  <li>Set the payload data in <code class="language-plaintext highlighter-rouge">d.Set</code> for name, description, and content version.</li>
</ul>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="n">d</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span><span class="n">payload</span><span class="p">[</span><span class="s">"name"</span><span class="p">])</span>
	<span class="n">d</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span><span class="n">payload</span><span class="p">[</span><span class="s">"description"</span><span class="p">])</span>
	<span class="n">d</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"content_version"</span><span class="p">,</span><span class="n">payload</span><span class="p">[</span><span class="s">"content_version"</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="delete-action">Delete Action</h3>
<ul>
  <li>Implement the HTTP request for deleting a resource.
    <pre><code class="language-GO">  req, err := http.NewRequest("DELETE", config.Endpoint+"/u/"+config.UserUuid+"/homes/"+homeUUID, nil)
  if err != nil {
      return diag.FromErr(err)
  }
</code></pre>
  </li>
  <li>Set the ID if the operation is successful and a print.
    <pre><code class="language-GO">  d.SetId("")
  log.Print("resourceHouseDelete:end")
</code></pre>
  </li>
</ul>

<p>|This repetition could potentially be refactored; try?|
|:‚Äî|</p>

<p>Next, we need to conduct the client call following the header, both for the delete operation and similarly for the update, read, and create operations.</p>

<h2 id="payload-processing-and-error-handling-in-api-requests">Payload Processing and Error Handling in API Requests</h2>

<p>The message body should contain all the details, here is a design for your reference.</p>

<p><img src="/journal/architectures/week2-anatomy-request.png" alt="Diagram Goes Here" /></p>

<ol>
  <li><strong>Pay Payload for a Post</strong>
    <ul>
      <li>To begin, we need to pay a payload for a post in createfunc.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">payloadBytes</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
 <span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Create Configuration</strong>
    <ul>
      <li>Now, let‚Äôs return to the creation process.</li>
      <li>After configuring, we need to pass a payload block.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">payload</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span>
 <span class="p">{</span> <span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Payload Formatting</strong>
    <ul>
      <li>It‚Äôs important to format the payload properly.</li>
      <li>Consider using a JSON function to convert it into bytes and add it as an argument to the next step.
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"name": d.Get("name").(string),
"description": d.Get("description").(string),
"domain_name": d.Get("domain_namae").(string),
"town": d.Get("town").(string),
"content_version": d.Get("content_version").(int64),
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Handling the Response</strong>
    <ul>
      <li>After completing the payload and putting it in the body, we should receive a response.</li>
      <li>We‚Äôll need to perform actions based on this response.</li>
      <li>Parse the response data.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">responseData</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">responseData</span><span class="p">);</span>  <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
<span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Closing the Response Body</strong>
    <ul>
      <li>Don‚Äôt forget to close the response body after you‚Äôre done with it.</li>
      <li>Use <code class="language-plaintext highlighter-rouge">resp.Body.Close()</code> to accomplish this.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">defer</span> <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Error Handling in Create</strong>
    <ul>
      <li>Obtain the code that will detect and handle errors from the server during the create process.</li>
      <li>Check if <code class="language-plaintext highlighter-rouge">resp.StatusCode</code> is not equal to <code class="language-plaintext highlighter-rouge">http.StatusOK</code> to determine if an error occurred.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span> <span class="o">!=</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"failed to create home resource, status_code: %d, status: %s, body %s"</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">bytes</span><span class="o">.</span><span class="n">NewBuffer</span><span class="p">(</span><span class="n">responseData</span><span class="p">)))</span>
 <span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Handling Errors in Delete</strong>
    <ul>
      <li>Similarly, for the delete operation, you‚Äôll need to implement error handling.</li>
      <li>Check the response status code for errors.
        <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span> <span class="o">!=</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"failed to delete home resource, status_code: %d, status: %s, body %s"</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">responseData</span><span class="p">))</span>
 <span class="p">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong>Setting the ID Value</strong>
    <ul>
      <li>In Terraform, when working with resources, it‚Äôs essential to return an ID.</li>
      <li>In the create step, add the following:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">homeUUID := response uuid string</code></li>
          <li>Set <code class="language-plaintext highlighter-rouge">d</code> to this value and print for debug.
```go
 d.SetId(‚Äú‚Äù)</li>
        </ul>
      </li>
    </ul>

    <p>log.Print(‚ÄúresourceHouseDelete:end‚Äù)
```</p>
  </li>
</ol>

<h3 id="setting-the-id-value">Setting the ID Value</h3>
<p>In Terraform, it‚Äôs important to return an ID whenever you have a resource.</p>
<ul>
  <li>In the create step, add the following:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">homeUUID := response uuid string</code></li>
      <li>Set <code class="language-plaintext highlighter-rouge">d</code> to this value, e.g., <code class="language-plaintext highlighter-rouge">d.set(homeUUID)</code>.</li>
    </ul>
  </li>
</ul>

<h3 id="reading-resource-data">Reading Resource Data</h3>
<p>Now, let‚Äôs focus on the read operation.</p>
<ul>
  <li>We need the home ID for this.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="n">config</span> <span class="o">:=</span> <span class="n">m</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">Config</span><span class="p">)</span>
    <span class="n">homeUUID</span> <span class="o">:=</span> <span class="n">d</span><span class="o">.</span><span class="n">Id</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>Revise the response status code to use an ‚Äúif-else‚Äù structure.
    <ul>
      <li>If it‚Äôs OK, return the data.</li>
    </ul>
  </li>
</ul>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
	<span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span> <span class="o">==</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span> <span class="p">{</span>
		<span class="c">// parse response JSON</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">NewDecoder</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">responseData</span><span class="p">);</span>  <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>
       <span class="c">// d.set</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span> <span class="o">!=</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusNotFound</span> <span class="p">{</span>
		<span class="n">d</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
	<span class="p">}</span> 
</code></pre></div></div>
<ul>
  <li>Use <code class="language-plaintext highlighter-rouge">d.Set</code> for all the content to be read, such as <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">content</code>, <code class="language-plaintext highlighter-rouge">desc</code>, <code class="language-plaintext highlighter-rouge">domain</code>, etc.
    <pre><code class="language-GO">   d.Set("name",responseData["name"].(string))
   d.Set("description",responseData["description"].(string))
   d.Set("domain_name",responseData["domain_name"].(string))
   d.Set("content_version",responseData["content_version"].(int64))
</code></pre>
  </li>
  <li>Consider handling cases where the status is not available to avoid config drift.
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span> <span class="o">!=</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"failed to read home resource, status_code: %d, status: %s, body %s"</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">responseData</span><span class="p">))</span>
    <span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>Good work!</p>
<h3 id="updating-resources">Updating Resources</h3>
<p>For the update operation, you‚Äôll need to use the payload from the create operation.</p>
<ul>
  <li>Exclude the <code class="language-plaintext highlighter-rouge">domain</code> and <code class="language-plaintext highlighter-rouge">town</code> since these should not change.</li>
  <li>Return the payload values for <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">desc</code>, <code class="language-plaintext highlighter-rouge">description</code>, and <code class="language-plaintext highlighter-rouge">content_ver</code>.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">d.Set</code> to update these values.</li>
</ul>

<h1 id="testing">Testing</h1>
<p>After implementing these actions, you should test your provider.</p>

<ol>
  <li>Build and initialize Terraform.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div>    </div>
  </li>
</ol>

<p>We have some issues and <strong>syntax error.</strong></p>

<ol>
  <li>Replace <code class="language-plaintext highlighter-rouge">err != {</code> with <code class="language-plaintext highlighter-rouge">err != nil {</code> in your code to resolve the issue.</li>
</ol>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Before</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

<span class="c">// After</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">diag</span><span class="o">.</span><span class="n">FromErr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>Build again baby.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div>    </div>
    <p>Error. <strong>HTTP error</strong></p>
  </li>
</ol>

<p><img src="/assets/2.4.0/http-error.png" alt="HTTP Hey" /></p>

<ol>
  <li>import the necessary package, you can add the statement as follows:
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span><span class="s">"net/http"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Build again one more.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div>    </div>
    <p>Error. <strong>We have an <code class="language-plaintext highlighter-rouge">undefined.FrontErr</code>.</strong></p>
  </li>
  <li>Change this with correct the usage of the identifier with this;</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FromErr
</code></pre></div></div>

<ol>
  <li>Building building!</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div></div>

<p>Another cute error,  <strong>the ‚Äúbytes‚Äù library is required.</strong></p>

<p><img src="/assets/2.4.0/bytes.png" alt="Bytes Hey" /></p>

<ol>
  <li>You can add the import statement like this to resolve the issue in your main.go:
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span> <span class="s">"bytes"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>We have gone through multiple builds, and to avoid spamming you with more build errors, I will now list the errors we encountered and how we resolved them.</p>

<p><strong>The Next ERROR;</strong></p>
<ul>
  <li>The variable <code class="language-plaintext highlighter-rouge">payloadBytes</code> is declared but not utilized on line 255 because we need to pass it instead of <code class="language-plaintext highlighter-rouge">nil</code>.</li>
  <li>We should use <code class="language-plaintext highlighter-rouge">bytes.NewBuffer</code> to create the buffer since it‚Äôs not reading. The same adjustment should be made for the <code class="language-plaintext highlighter-rouge">createAction</code> and <code class="language-plaintext highlighter-rouge">readOnly</code> functions.</li>
</ul>

<p><strong>The Next ERROR +1;</strong></p>
<ul>
  <li>We don‚Äôt need <code class="language-plaintext highlighter-rouge">responseData</code> for the update operation. We are not interested in it.</li>
  <li>Please remove <code class="language-plaintext highlighter-rouge">responseData</code> and only capture the response body.</li>
  <li>Take the <code class="language-plaintext highlighter-rouge">responseData</code> from the delete function as well.</li>
</ul>

<ol>
  <li>Building the great build!</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div></div>

<p>We‚Äôve successfully built it now!</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">ü§Ø</th>
      <th style="text-align: left">It‚Äôs okay if it seems confusing at the moment;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">üíØ</td>
      <td style="text-align: left">Things will get easier</td>
    </tr>
    <tr>
      <td style="text-align: right">üßê</td>
      <td style="text-align: left">When we start examining the tfstate file</td>
    </tr>
    <tr>
      <td style="text-align: right">üí™</td>
      <td style="text-align: left">Don‚Äôt give up King or Queen.</td>
    </tr>
  </tbody>
</table>

<h3 id="test-the-magic">Test The Magic</h3>

<p>Does this actually now provision anything? 
Is it working as expected?</p>

<p>This is communicating with our Sinatra server.</p>

<ol>
  <li>do <code class="language-plaintext highlighter-rouge">tf init</code> and let‚Äôs see.</li>
</ol>

<p>We encountered a failure while querying available provider packages.</p>

<ul>
  <li>Please ensure consistency in naming.</li>
  <li>Use the resource name <code class="language-plaintext highlighter-rouge">terratowns_home</code> instead of <code class="language-plaintext highlighter-rouge">terratown_home</code>.</li>
</ul>

<ol>
  <li>check your terraform providers locally.</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>terraform providers

Providers required by configuration:
<span class="nb">.</span>
‚îú‚îÄ‚îÄ provider[local.providers/local/terratowns] 1.0.0
‚îî‚îÄ‚îÄ provider[registry.terraform.io/hashicorp/terratown]
</code></pre></div></div>

<ol>
  <li>do it again after the update! Perfect.</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Providers required by configuration:
<span class="nb">.</span>
‚îî‚îÄ‚îÄ provider[local.providers/local/terratowns] 1.0.0
</code></pre></div></div>
<p>This change is necessary because in the provider schema function of <code class="language-plaintext highlighter-rouge">main.go</code>, it is defined as <code class="language-plaintext highlighter-rouge">teratown_home</code>.</p>

<ol>
  <li>Double check <code class="language-plaintext highlighter-rouge">tf init</code> now. Works!</li>
  <li><code class="language-plaintext highlighter-rouge">terraform plan</code> and let‚Äôs see.</li>
</ol>

<p>We‚Äôve got the resource! <code class="language-plaintext highlighter-rouge">A custom resource has been planned</code>!</p>

<p><img src="/assets/2.4.0/tf-planed.png" alt="Plan Resource Yay!" /></p>

<ul>
  <li>The mock server is not a real server,</li>
  <li>This won‚Äôt behave exactly the same way as the actual server.</li>
</ul>

<p>We can play a little bit around before targetting the terratown.</p>

<ol>
  <li>Apply your changes with <code class="language-plaintext highlighter-rouge">terraform apply</code> for too much errors to come ofc.</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Error Description</th>
      <th>Resolution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Spelling mistake: <code class="language-plaintext highlighter-rouge">domain_namae</code> -&gt; <code class="language-plaintext highlighter-rouge">name</code></td>
      <td>Update the variable name to ‚Äúname‚Äù</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Build provider to delete files</td>
      <td>Execute <code class="language-plaintext highlighter-rouge">./bin/build_provider</code></td>
    </tr>
    <tr>
      <td>3</td>
      <td>Initialize and apply Terraform</td>
      <td>Run <code class="language-plaintext highlighter-rouge">terraform init</code> and <code class="language-plaintext highlighter-rouge">terraform apply</code></td>
    </tr>
    <tr>
      <td>4</td>
      <td>Code block issue with <code class="language-plaintext highlighter-rouge">&lt;</code>, related to JSON parsing</td>
      <td>Ensure the response is valid JSON and not HTML or other</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Invalid character <code class="language-plaintext highlighter-rouge">&lt;</code>, looking for value start</td>
      <td>Validate the data from the API is valid JSON</td>
    </tr>
    <tr>
      <td>6</td>
      <td>URL adjustment needed: hit ‚Äú/api/home‚Äù instead</td>
      <td>Change the URL to ‚Äú/api/home‚Äù</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Issue with endpoint in create script (only ‚Äúhome‚Äù)</td>
      <td>Modify the endpoint to include ‚Äú/api‚Äù in <code class="language-plaintext highlighter-rouge">main.tf</code></td>
    </tr>
    <tr>
      <td>8</td>
      <td>Reattempt after endpoint correction</td>
      <td>Rebuild, initialize, and apply</td>
    </tr>
  </tbody>
</table>

<p>I‚Äôve found a better way to present the errors I encountered in these eight steps, allowing you to tackle and resolve each one systematically.</p>

<p>The last apply will get your custom resource to be provisioned.</p>

<p>Great and cool!</p>

<p><img src="/assets/2.4.0/resource-deployed-terratowns.png" alt="1 Resource Created!" /></p>

<p><strong>NOTE:</strong> I had to <a href="/assets/2.4.0/401-issue.png">deal with a 401</a> before my last succefull apply. <br />I fixed with a simple replace of the current uuid with mine for the sinatra server.</p>

<p><img src="/assets/2.4.0/401-resolve.png" alt="401: Replaced and Resolved" /></p>

<h2 id="state-file-effects">State File Effects</h2>
<p>It‚Äôs retaining this state, so we should be able to continue mocking it.</p>

<p>The state file in Terraform keeps track of the resource‚Äôs status, including the <code class="language-plaintext highlighter-rouge">homeUUID</code>. It‚Äôs crucial for Terraform to maintain resource mapping.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="nl">"terraform_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.6.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"serial"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"lineage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"861def3e-f028-0a8f-c9bd-de51c87602fb"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"managed"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"terratowns_home"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"home"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"provider"</span><span class="p">:</span><span class="w"> </span><span class="s2">"provider[</span><span class="se">\"</span><span class="s2">local.providers/local/terratowns</span><span class="se">\"</span><span class="s2">]"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"instances"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"schema_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"content_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Yaya is making something so great and  so innovative.</span><span class="se">\n</span><span class="s2">Something Amazing is cooking with the greatest and only Yaya.</span><span class="se">\n</span><span class="s2">Feeling Empowered.</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"domain_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"veryveryrandomm.cloudfront.net"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"833761b8-c2d7-4b17-91b4-0e2237184078"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"How to play League in 2023"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"town"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gamers-grotto"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nl">"sensitive_attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
          </span><span class="nl">"private"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bnVsbA=="</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"check_results"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Examine the state file to check for sensitive data (a valuable lesson to be learned).</p>
<ul>
  <li>It does not store sensitive data here.</li>
  <li>We can view our schema for the resource and the provider we created.</li>
</ul>

<p>The most important aspect is the ID, as the Terraform provider relies on it to maintain the mapping accurately.</p>

<h2 id="correct-and-make-changes">Correct and Make Changes</h2>
<p>You can make changes to your resource properties and apply them.</p>

<p>Terraform will detect and update the state accordingly.</p>

<h4 id="lets-make-changes">Let‚Äôs Make Changes</h4>

<ol>
  <li>Change <code class="language-plaintext highlighter-rouge">name</code> to <code class="language-plaintext highlighter-rouge">resource name</code> in <code class="language-plaintext highlighter-rouge">main.tf</code> and we encounter an error.
    <ul>
      <li>We wanted ‚Äúhome,‚Äù but it‚Äôs ‚ÄúHouse,‚Äù e.g., ‚ÄúHouseCreate.‚Äù</li>
    </ul>
  </li>
  <li>Change <code class="language-plaintext highlighter-rouge">init</code> to <code class="language-plaintext highlighter-rouge">float64</code>.
    <ul>
      <li>Another error occurs because of the state file.</li>
      <li>Error occurs because in one place it‚Äôs <code class="language-plaintext highlighter-rouge">init</code>, and in another, it‚Äôs <code class="language-plaintext highlighter-rouge">float64</code>.</li>
    </ul>
  </li>
  <li>Data type mapping:
    <ul>
      <li>Create: <code class="language-plaintext highlighter-rouge">int</code></li>
      <li>Read: <code class="language-plaintext highlighter-rouge">float64</code></li>
      <li>Update: <code class="language-plaintext highlighter-rouge">int</code></li>
      <li>This mapping is based on how the response is received.</li>
    </ul>
  </li>
  <li>Resolution Steps:
    <ul>
      <li>Build.</li>
      <li>Delete state.</li>
      <li>Stop Sinatra.</li>
      <li><code class="language-plaintext highlighter-rouge">tf init</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">tf apply --auto-approve</code>.</li>
      <li>These steps are taken to resolve the error.</li>
    </ul>
  </li>
  <li>It was created.
    <ul>
      <li>Go to Sinatra and verify.</li>
      <li>Confirm that it‚Äôs created.</li>
    </ul>
  </li>
  <li>Make a change, and then reapply.
    <ul>
      <li>It detects that the description has changed and prompts for confirmation.</li>
      <li>Observe that the state now contains the updated information.</li>
    </ul>
  </li>
  <li>There‚Äôs a double name in the update; change it to ‚Äúdescription‚Äù and double-check.
    <ul>
      <li>Ensure that there is no duplication.</li>
    </ul>
  </li>
  <li>Make an update to the description or name.
    <ul>
      <li>Run <code class="language-plaintext highlighter-rouge">tf apply</code>.</li>
      <li>Ensure Sinatra is running.
        <blockquote>
          <p>Also, the apply do both update and show.</p>
        </blockquote>
      </li>
    </ul>
  </li>
  <li>It updates our state, and the names align as desired.
    <ul>
      <li>Confirm that the state reflects the changes.</li>
    </ul>
  </li>
</ol>

<h4 id="cleanup">Cleanup</h4>

<ol>
  <li>Destroy the state. All is perfect!</li>
</ol>

<p><img src="/assets/2.4.0/destroy-league.png" alt="Destroyed League Resource" /></p>

<p>Destroying the state will remove it completely. I used to play <a href="https://en.wikipedia.org/wiki/League_of_Legends">league of legends</a> from the age 16 to 20.</p>

<p>Up from that point, I live in the cloud.</p>

<h3 id="considerations-1">Considerations</h3>

<ul>
  <li>Are there any edge cases? (unknown)</li>
  <li>Are there any overlooked factors? (unknown)</li>
</ul>

<p>Writing a robust Terraform provider can be a challenging task. <br />It‚Äôs impressive to achieve this, and it‚Äôs undeniably cool!</p>

<ul>
  <li>The next step involves utilizing the provider with the actual Terratown endpoint.</li>
  <li>This will require setting up Terratown accounts and obtaining the necessary access.</li>
</ul>

<p>We‚Äôve reached a significant milestone with our progress. <br /></p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">üõë</th>
      <th style="text-align: left">This is a hard good Stop!</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">¬†</td>
      <td style="text-align: left">¬†</td>
    </tr>
  </tbody>
</table>

<h1 id="target-terratowns-api">Target TerraTowns API</h1>

<p>Welcome to <code class="language-plaintext highlighter-rouge">2.5.0</code> where we‚Äôll be testing our custom provider against real TerraTowns infrastructure.</p>

<ul>
  <li><a href="#configuration-steps">Configuration Steps</a></li>
  <li><a href="#initial-terratowns-testing">Initial Terratowns Testing</a></li>
  <li><a href="#token-handling">Token Handling</a>
    <ul>
      <li><a href="#example-for-access-token">Example for access token</a></li>
      <li><a href="#bucket-name-randomization">Bucket Name Randomization</a></li>
    </ul>
  </li>
  <li><a href="#testing-your-first-terratown">Testing Your First TerraTown</a></li>
</ul>

<p>We will be configuring access tokens, endpoints, and other necessary settings to ensure our custom provider works seamlessly with TerraTowns.</p>

<h3 id="configuration-steps">Configuration Steps</h3>

<p>We will get Terraformcloud back.</p>

<h4 id="1-access-token-setup">1. Access Token Setup</h4>

<p>To use TerraTown, follow these steps:</p>

<ol>
  <li>In your provider block, set the endpoint to <code class="language-plaintext highlighter-rouge">terratowns.cloud/api</code>.</li>
  <li>Obtain your user UUID from your ExamPro account.</li>
</ol>

<p><img src="/assets/2.5.0/uuid-teacher-seat.png" alt="Where is my UUID" /></p>

<ol>
  <li>Just there, click setting and</li>
  <li>Click Vending machine from left pane.</li>
  <li>Click on TerraTowns Access Code</li>
  <li>Get the access token below in the page.</li>
</ol>

<p><img src="/assets/2.5.0/access-code-get.png" alt="Where is my access token" /></p>

<h3 id="initial-terratowns-testing">Initial Terratowns Testing</h3>
<ol>
  <li>Go to your <code class="language-plaintext highlighter-rouge">main.tf</code> custom provider and fill in the uuid values.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  endpoint <span class="o">=</span> <span class="s2">"http://localhost:4567/api"</span>
  <span class="nv">user_uuid</span><span class="o">=</span><span class="s2">""</span> 
  <span class="nv">token</span><span class="o">=</span><span class="s2">""</span>
</code></pre></div>    </div>
  </li>
</ol>

<p><strong>To</strong>;</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  endpoint <span class="o">=</span> <span class="s2">"http://terratowns.cloud/api"</span>
  <span class="nv">user_uuid</span><span class="o">=</span><span class="s2">""</span> 
  <span class="nv">token</span><span class="o">=</span><span class="s2">""</span>
</code></pre></div></div>
<blockquote>
  <p>‚ö†Ô∏èDon‚Äôt commit your values. We will var them later.</p>
  <ol>
    <li>Fill with missingo as our first town of choice in our one and only <code class="language-plaintext highlighter-rouge">terratowns_home</code> resource.
      <div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">town</span> <span class="err">=</span> <span class="s2">"gamers-grotto"</span>
</code></pre></div>      </div>
      <p>This how we target where our page will be part of.</p>
    </li>
  </ol>
</blockquote>

<ol>
  <li>Try a random domain url for now.</li>
</ol>

<p>The domain doesn‚Äôt lead to any destination, but that‚Äôs fine. Let it be, for now. For You</p>

<ol>
  <li>Execute the following command:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./bin/build_provider
</code></pre></div>    </div>
  </li>
  <li>Initialize and apply Terraform:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tf init
tf apply
</code></pre></div>    </div>
  </li>
</ol>

<p>After execution, you will receive valuable debugging information.</p>

<ol>
  <li>Confirm by clicking <code class="language-plaintext highlighter-rouge">Yes.</code></li>
</ol>

<p>You may have another 401 error, like we had earlier.</p>

<ul>
  <li>Map the UUID again in server.rb with the one from ExamPro.</li>
  <li>Make sure you target terraform.cloud in your endpoint.</li>
</ul>

<p><img src="/assets/2.5.0/gamers-grotto-poc.png" alt="Good Plan" /></p>

<ol>
  <li>
    <p>Make sure you apply your changes.</p>
  </li>
  <li>
    <p>Navigate to terratowns.cloud/t/ur-town.</p>
  </li>
</ol>

<p>You will find your profile displayed as a rectangle. <br />
Clicking it will redirect you to the seemingly useless CloudFront.</p>

<p><img src="/assets/2.5.0/on-click-wrong-url.png" alt="Terratowns url is brokie" /></p>

<p>Now, the question is whether the CloudFront real URL will take you to this location, or if we need to pass custom headers or headers through CloudFront to make it work. This will be determined.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Update not allowed If you change your domain name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">By design, You will need to perform a total teardown</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>To proceed, execute the following command:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tf destroy
</code></pre></div>    </div>
    <p><img src="/assets/2.5.0/destroy-for-new-url-sake.png" alt="Destroyed for new URL" /></p>
  </li>
  <li>Update the url to map to your own cloudfront url.</li>
  <li>Click on your post in <a href="https://terratowns.cloud/">terratowns.cloud</a>.</li>
</ol>

<p><img src="/assets/2.5.0/terratown-yaya.png" alt="Directing To My Page" /></p>

<p>It is now directing to my page. It has anime in it with</p>

<h3 id="token-handling">Token Handling</h3>

<p>To securely handle tokens, do the following:</p>

<ul>
  <li>Avoid storing them directly in the <code class="language-plaintext highlighter-rouge">main.tf</code> file.</li>
  <li>Use the <code class="language-plaintext highlighter-rouge">TF_VARS</code> environment variables for token management.
    <h4 id="example-for-access-token">Example for access token</h4>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export TF_VARS_terratowns_access_token="your_access_token_here"
gp env TF_VARS_terratowns_access_token="your_access_token_here"
</code></pre></div>    </div>
  </li>
</ul>

<p>This will allow you to reference the access token in your <code class="language-plaintext highlighter-rouge">main.tf</code> file using <code class="language-plaintext highlighter-rouge">var.terratowns_access_token</code>.</p>

<h4 id="endpoint-and-uuid-configuration">Endpoint and UUID Configuration</h4>
<ol>
  <li>Set the TerraTowns endpoint in your <code class="language-plaintext highlighter-rouge">terraform.tfvars</code> file:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terratowns_endpoint = "https://terratowns.cloud/api"
</code></pre></div>    </div>
  </li>
</ol>

<p>If set wrong; verify <code class="language-plaintext highlighter-rouge">TF_VAR</code> and not <code class="language-plaintext highlighter-rouge">TF_VARS</code>.</p>

<p><img src="/assets/2.5.0/var-endpoint.png" alt="Var Error Endpoint" /></p>

<p>You can access the endpoint in your code using <code class="language-plaintext highlighter-rouge">var.terratowns_endpoint</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TF_VAR_terratowns_endpoint</span><span class="o">=</span><span class="s2">"terratowns.cloud/api"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">user_uuid</code> already there we can call it just var.user_uuid. Let employ this..</p>

<ol>
  <li>Run the following commands in your gitpod and incldue your uuid;
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TF_VAR_teacherseat_user_uuid</span><span class="o">=</span><span class="s2">"pastehere"</span>
gp <span class="nb">env </span><span class="nv">TF_VAR_teacherseat_user_uuid</span><span class="o">=</span><span class="s2">"pastehere"</span>
</code></pre></div>    </div>
  </li>
  <li>Define those variables in your variables.tf, otherwise it wont work.
```hcl
variable ‚Äúterratowns_endpoint‚Äù {
 type = string
}</li>
</ol>

<p>variable ‚Äúterratowns_access_token‚Äù {
 type = string
}</p>

<p>variable ‚Äúteacherseat_user_uuid‚Äù {
 type = string
}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4. remove the previous `uuid` assignement.
5. Add it to the commented terrahouse module (for last tag)
6. Employ the same for our access token.

```sh
export TF_VAR_terratowns_access_token=""
gp env TF_VAR_terratowns_access_token=""
</code></pre></div></div>
<ol>
  <li>Set your real Cloudfront URL and let‚Äôs give trry
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  domain_name <span class="o">=</span> module.terrahouse_aws.cloudfront_url
</code></pre></div>    </div>
  </li>
  <li>uncomment your terrahouse module.</li>
  <li>Update your <code class="language-plaintext highlighter-rouge">terraform.tfvars</code> from <code class="language-plaintext highlighter-rouge">terraform.tfvars.sample</code> just in case you have code inline.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">tf init</code> is success follow it by <code class="language-plaintext highlighter-rouge">tf apply</code>;</li>
</ol>

<blockquote>
  <p><a href="https://chat.openai.com/share/78308298-de74-4021-a294-7c715c768707">Error on the way.</a></p>
</blockquote>

<p>Is there another error in the code? <br />Haha, remember that trap from Week Zero?</p>

<p>I fixed this already. But allow me please to fix yours in the next section.</p>

<p>This can help <code class="language-plaintext highlighter-rouge">env | grep TF_VAR</code></p>

<h4 id="master-resolve-for-you">Master Resolve For You</h4>

<p>After initializing and applying Terraform configurations, you may encounter errors.</p>

<p>Ensure that the asset URL in <code class="language-plaintext highlighter-rouge">tfvars.sample</code> ends with a <code class="language-plaintext highlighter-rouge">/</code>. Also, add the <code class="language-plaintext highlighter-rouge">asset_path</code> parameter to the TerraHouse AWS module.</p>

<ol>
  <li>Append a <code class="language-plaintext highlighter-rouge">/</code> to the end of the asset URL in <code class="language-plaintext highlighter-rouge">tfvars.sample</code>.</li>
  <li>Within the <code class="language-plaintext highlighter-rouge">terrrhouse_aws</code> module, specifically in the main Terraform root file main.tf, pass the value of <code class="language-plaintext highlighter-rouge">var.assets._path</code> as <code class="language-plaintext highlighter-rouge">asset_path</code>.</li>
  <li>Feel free to run terraform apply which will end up a great success.</li>
</ol>

<p>The sole distinctive aspect in this situation is related to the unique bucket name.</p>

<h4 id="bucket-name-randomization">Bucket Name Randomization</h4>

<p>I believe we‚Äôve successfully handled validation and using a random provider, now it‚Äôs time to standardize the process for generating bucket names.</p>

<p>Let‚Äôs generate a random bucket name just for the sake of it.</p>

<p>To make the bucket name random:</p>
<ol>
  <li>Obtain the bucket name from <code class="language-plaintext highlighter-rouge">tfvars</code> and the TerraHouse AWS module.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"terrahouse_aws"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./modules/terrahouse_aws"</span>
  <span class="nx">user_uuid</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">teacherseat_user_uuid</span>
  <span class="nx">index_html_filepath</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">index_html_filepath</span>
  <span class="nx">error_html_filepath</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">error_html_filepath</span>
  <span class="nx">content_version</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">content_version</span>
  <span class="nx">assets_path</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">assets_path</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Add comment for the bucket name setting in the CDN module and change as required;</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  comment             <span class="o">=</span> <span class="s2">"Static website hosting for: </span><span class="k">${</span><span class="nv">var</span><span class="p">.bucket_name</span><span class="k">}</span><span class="s2">"</span>

  comment             <span class="o">=</span> <span class="s2">"Static website hosting for: </span><span class="k">${</span><span class="nv">aws_s3_bucket</span><span class="p">.website_bucket.bucket</span><span class="k">}</span><span class="s2">"</span>
</code></pre></div></div>
<ol>
  <li>Update variables and remove bucket validation in the CDN module. (I did in previous instruction)</li>
  <li>Modify the CDN module to reference the update bucket output.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">name</span>   <span class="err">=</span> <span class="s2">"OAC ${aws_s3_bucket.website_bucket.bucket}"</span>
  <span class="nx">description</span>  <span class="err">=</span> <span class="s2">"Origin Access Controls for Static Website Hosting ${aws_s3_bucket.website_bucket.bucket}"</span>
</code></pre></div>    </div>
  </li>
  <li>The terraform plan touchpoint will tell that the bucket name it provides afterward (know after apply)</li>
</ol>

<p><img src="/assets/2.5.0/back-to-bucket-random.png" alt="Great and Cool Plan Bucket Back To normal" /></p>

<p>After applying Terraform configurations, the bucket name should be randomized.</p>

<p>The reason you observe the creation of <strong>only a single resource</strong> is because the apply becomes hang and it needed the AWS CLI to execute the invalidation process.</p>

<p>This was a preivously running workspace. I ran the aws cli  again using our script briefly and get the apply going.</p>

<h3 id="testing-your-first-terratown">Testing Your First TerraTown</h3>

<p>Now if you go you can find ur page there.
terraform.cloud/</p>

<p><img src="/assets/2.5.0/used-to-be-gamers-grotto.png" alt="First Page Terratown" /></p>

<table>
  <thead>
    <tr>
      <th><a href="https://terratowns.cloud/t/gamers-grotto">Check it out!</a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>¬†</td>
    </tr>
  </tbody>
</table>

<p>It is a mix of gaming and anime. Hope you like the creativity.</p>

<p>Once you have configured TerraTown, we can:</p>

<ul>
  <li>Access your TerraTown page.</li>
  <li>Configure multiple pages if needed.</li>
  <li>Test updates to ensure everything works as expected.</li>
  <li>Pushing our custom provider to the community.</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">For further, consider integrating TerraTown with Terraform Cloud</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">¬†</td>
    </tr>
  </tbody>
</table>

<p>We are currently in the final stages of completing version <code class="language-plaintext highlighter-rouge">2.5.0</code> and soon.. <br />Everythingüòî</p>

<p>This specific provides a clear overview and step-by-step instructions for testing your custom provider against TerraTowns and pushing your post and your site to the town.</p>

<h1 id="terraform-turbocharge-workflow">Terraform Turbocharge Workflow</h1>

<p>Welcome to the Terraform  <code class="language-plaintext highlighter-rouge">2.6.0</code> last official release with primary objective to integrate Terraform Cloud with our local development environments.</p>
<ul>
  <li><a href="#problematic-101">Problematic 101</a></li>
  <li><a href="#problematic-202">Problematic 202</a></li>
  <li><a href="#resovlver-pro-max">Resovlver Pro Max</a></li>
  <li><a href="#head-over-terraform-cloud">Head over Terraform Cloud</a></li>
</ul>

<p>The following comes after an experience with different ways to work with terraform and thus coming up with the best possible solution.</p>

<p>The multiple home feature was part of this and it now part of <code class="language-plaintext highlighter-rouge">2.7.0</code>.<br />
Learn more <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/issues/61">about our methodology</a>.</p>

<h2 id="problematic-101">Problematic 101</h2>
<p>We previously operated exclusively using local execution, which resulted in rapid infrastructure planning and implementation.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">‚ùå</th>
      <th style="text-align: left">We encountered a challenge where our infrastructure state was lost whenever we stopped our workspace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">¬†</td>
      <td style="text-align: left">¬†</td>
    </tr>
  </tbody>
</table>

<h2 id="problematic-202">Problematic 202</h2>
<p>We have now made a complete shift to using Terraform Cloud, and this transition has yielded positive outcomes for our state management. Our infrastructure state is secure and preserved, ensuring that it remains intact even when we pause our work.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">‚ùå</th>
      <th style="text-align: left">We have observed a decrease in execution speed when utilizing Terraform Cloud‚Äôs compute resources</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">¬†</td>
      <td style="text-align: left">¬†</td>
    </tr>
  </tbody>
</table>

<h2 id="resovlver-pro-max">Resovlver Pro Max</h2>
<p>These experiences bring us to the following solution.</p>

<p><strong>Ensuring safety and persistence and never lose your state;</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">‚õëÔ∏è</th>
      <th style="text-align: left">Preserve and manage our infrastructure state within Terraform Cloud</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">¬†</td>
      <td style="text-align: left">¬†</td>
    </tr>
  </tbody>
</table>

<p><strong>Optimize for the speed of our operations;</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">üèéÔ∏è</th>
      <th style="text-align: left">Conduct our computations and executions against a local CDE infrastructure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">¬†</td>
      <td style="text-align: left">¬†</td>
    </tr>
  </tbody>
</table>

<p>Welcome to this self-dedicated space for version <code class="language-plaintext highlighter-rouge">2.6.0</code>.</p>

<h2 id="head-over-terraform-cloud">Head over Terraform Cloud</h2>

<p>I thought you may forget what is that. <a href="https://developer.hashicorp.com/terraform/cloud-docs">Get the knowledge back.</a></p>

<ol>
  <li>Access Terraform Cloud by following these steps:
    <ul>
      <li>Click ‚ÄúTry Terraform Cloud.‚Äù</li>
      <li>Select your ‚Äúterra-house-1‚Äù project.</li>
    </ul>
  </li>
</ol>

<p><img src="/assets/2.6.0/terra-house-2023.png" alt="TerraHouse" /></p>

<ol>
  <li>Configure Execution Mode:
    <ul>
      <li>Change the execution mode to ‚Äúlocal‚Äù in Terraform Cloud.</li>
      <li>After you picked your project, click <strong>settings</strong> from the left pane<br />
<img src="/assets/2.6.0/click-settings.png" alt="Settings Project Pane" /></li>
    </ul>
  </li>
</ol>

<p><strong>The general pane will now popup.</strong></p>
<ul>
  <li>In the same page, swipe below and look for exec mode.<br />
<img src="/assets/2.6.0/general-pane-popup.png" alt="General Project Settings Pane" /></li>
</ul>

<p>You will find that there is no option for local execution.</p>

<p><img src="/assets/2.6.0/you-dont-see-local.png" alt="No option for local exec" /></p>

<p>Also you see that your organization is set on the remote as shown in this asset.</p>

<ul>
  <li>Click set to <strong>remote</strong> direction.</li>
</ul>

<p>This will take you to organization  general settings.</p>
<ul>
  <li>Look at your org setting and leave it as it is.</li>
</ul>

<p><img src="/assets/2.6.0/default-org-exec.png" alt="Org Observe only" /></p>

<ul>
  <li>Go back to your project level.</li>
  <li>Click on custom, pick a the local option and click update below.</li>
</ul>

<p><img src="/assets/2.6.0/project-custom.png" alt="Project Update To Local" /></p>

<p>This is done to improve command execution speed as running commands directly in Terraform Cloud might be slower.</p>

<p>Remmember again that it‚Äôs essential to keep your state safe in the cloud.</p>

<p><strong>Note:</strong> Make sure to update the project level settings, not the organization level.</p>

<ol>
  <li>Return to GitPod:
    <ul>
      <li>In your GitPod environment, add the ‚Äúcloud‚Äù section in your main.tf file e.g.</li>
    </ul>
  </li>
</ol>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cloud</span> <span class="p">{</span>
<span class="nx">organization</span> <span class="p">=</span> <span class="s2">"yayaintfcloud"</span>

<span class="nx">workspaces</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"terra-house-2023"</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li>Build the plugin provider and set it to auto in the Terraform section.</li>
</ul>

<ol>
  <li>Initialize and apply the Terraform configuration:
    <ul>
      <li>
        <p>Run <code class="language-plaintext highlighter-rouge">terraform init</code> <br />
<img src="/assets/2.6.0/init-tf-cloud.png" alt="TF Init with TF Cloud" /></p>
      </li>
      <li>
        <p>Followed by <code class="language-plaintext highlighter-rouge">terraform apply</code> to deploy your configuration to Terraform Cloud.</p>
      </li>
    </ul>
  </li>
</ol>

<p>Observe the state is now in your terraform dotfile.</p>

<p><img src="/assets/2.6.0/tf-cloud-local-exec.png" alt="Local Provider Proof As well.." /></p>

<p>Have you also noticed? <strong>It is damn fast as it used to.</strong> But not only that..</p>

<ol>
  <li>Monitor the Terraform Cloud dashboard and find your state and secure and downloadable anytime, anywhere.</li>
</ol>

<p><img src="/assets/2.6.0/state-managed.png" alt="Terraform Cloud Consult" /></p>

<p><strong>State</strong> is now managed by <strong>Terraform Cloud</strong> with your <strong>local execution</strong> to your development environment!</p>

<p><img src="/assets/2.6.0/local-exec.png" alt="Local Exec in TF Cloud again, for you.." /></p>

<p>You can stop that and return to it later, <strong>knowing that your state is stored in the cloud.</strong></p>

<p>The thing about Terraform Cloud that will not prompt for approvals but will display the current status of your operations.</p>

<h3 id="additional">Additional.</h3>

<p>In order for me to do this. <br />I had to migrate to codespaces and did the entire process from the start to finish to name a few;</p>
<ul>
  <li>Terraform Login</li>
  <li>AWS Credentials</li>
  <li>Configured terraformrc dot file.</li>
  <li>Explore the plugin path.</li>
  <li>Dealt with too many instant error/resolve.</li>
</ul>

<p>Great, cool and easy now.<br /> <strong>Consider pushing the provider to the registry for future use.</strong></p>

<h1 id="terrahomes-to-terratowns">TerraHomes to TerraTowns</h1>
<p>This is setup in <code class="language-plaintext highlighter-rouge">2.7.0</code> will lay the foundation to enable you with the creation of multiple homes or houses within the platform as it now supports up to twelve homes or houses.</p>

<ul>
  <li><a href="#the-first-music-post">The First Music Post</a>
    <ul>
      <li><a href="#check-out-the-music-home">Check out The Music Home</a></li>
    </ul>
  </li>
  <li><a href="#check-out-the-tunisian-food-post">Check Out The Tunisian Food Post</a>
    <ul>
      <li><a href="#check-out-the-list-in-terrahome">Check Out The list in TerraHome</a></li>
    </ul>
  </li>
  <li><a href="#terraform-state-management">Terraform State Management</a></li>
  <li><a href="#troubleshooting-and-finalization">Troubleshooting and Finalization</a></li>
  <li><a href="#joyful-conclusion">Joyful conclusion</a></li>
</ul>

<p>To enable the deployment of multiple homes simultaneously on the Terratowns platform, follow these steps:</p>

<p><strong>Step 1: Create TerraHomes Folders</strong></p>

<p>Create separate folders within the ‚Äúpublic‚Äù directory for each home and migrate all project files to them.</p>

<ol>
  <li>Create a folder named ‚Äúhome1‚Äù and move your project files into it.</li>
  <li>Create a second folder named ‚Äúhome2‚Äù and duplicate the files in the same format.</li>
  <li>Make sure the structure is something like this;
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>üìÅ public
  |‚îÄ üè† home1
  |   ‚îî‚îÄ üìÇ assets
  |       ‚îî‚îÄ üñºÔ∏è great-stuff.png
  |   ‚îî‚îÄ üìÑ index.html
  |   ‚îî‚îÄ üìÑ error.html
  ‚îî‚îÄ üè† home2
   ‚îî‚îÄ üìÇ assets
       ‚îî‚îÄ üñºÔ∏è great-stuff.png
   ‚îî‚îÄ üìÑ index.html
   ‚îî‚îÄ üìÑ error.html
</code></pre></div>    </div>
  </li>
</ol>

<p><strong>Step 2: Rename Module</strong></p>

<p>Since we are loving it on homes rather than houses..</p>

<ul>
  <li>Rename the module from ‚Äúterrahouse_aws‚Äù to <code class="language-plaintext highlighter-rouge">terrahome_aws.</code></li>
</ul>

<p><img src="/assets/2.7.0/terrahome-love.png" alt="Renamed To TerraHome" /></p>

<p><strong>Step 3: Update Configuration</strong></p>

<p>Make the following updates to accommodate the changes related to <code class="language-plaintext highlighter-rouge">terrahome_aws</code> variables and modules:</p>
<ul>
  <li>Update the source to point to <code class="language-plaintext highlighter-rouge">./modules/terrahome_aws</code> instead of the old source to the <code class="language-plaintext highlighter-rouge">terrahouse</code>.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">source</span> <span class="err">=</span> <span class="s2">"./modules/terrahome_aws"</span>
</code></pre></div>    </div>
  </li>
  <li>Change the module name to match the theme, e.g.,
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"home_tnrap_hosting"</span> <span class="p">{}</span>
</code></pre></div>    </div>
  </li>
  <li>Modify <code class="language-plaintext highlighter-rouge">output.tf</code> to reference <code class="language-plaintext highlighter-rouge">home_yourhousename_hosting</code> instead of <code class="language-plaintext highlighter-rouge">terrahouse_aws.</code> for <code class="language-plaintext highlighter-rouge">bucket_name</code></li>
</ul>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">value</span> <span class="err">=</span> <span class="nx">module</span><span class="err">.</span><span class="nx">terrahouse_aws</span><span class="err">.</span><span class="nx">bucket_name</span>

  <span class="nx">value</span> <span class="err">=</span> <span class="nx">module</span><span class="err">.</span><span class="nx">home_tnrap_hosting</span><span class="err">.</span><span class="nx">bucket_name</span>
  <span class="nx">value</span> <span class="err">=</span> <span class="nx">module</span><span class="err">.</span><span class="nx">home_tnfood_hosting</span><span class="err">.</span><span class="nx">bucket_name</span>
</code></pre></div></div>

<ul>
  <li>Do the same in for the output of <code class="language-plaintext highlighter-rouge">s3_website_endpoint</code></li>
</ul>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">value</span> <span class="err">=</span> <span class="k">module</span><span class="err">.</span><span class="nx">terrahouse_aws</span><span class="err">.</span><span class="nx">website_endpoint</span>

  <span class="nx">value</span> <span class="err">=</span> <span class="k">module</span><span class="err">.</span><span class="nx">home_tnrap_hosting</span><span class="err">.</span><span class="nx">website_endpoint</span>
  <span class="nx">value</span> <span class="err">=</span> <span class="k">module</span><span class="err">.</span><span class="nx">home_tnfood_hosting</span><span class="err">.</span><span class="nx">website_endpoint</span>
</code></pre></div></div>

<ul>
  <li>Do the same for the <code class="language-plaintext highlighter-rouge">cloudfront_url</code> and change output to reference <code class="language-plaintext highlighter-rouge">domain_name</code> instead.</li>
</ul>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">value</span> <span class="err">=</span> <span class="k">module</span><span class="err">.</span><span class="nx">terrahouse_aws</span><span class="err">.</span><span class="nx">cloudfront_url</span>
  <span class="nx">value</span> <span class="err">=</span> <span class="k">module</span><span class="err">.</span><span class="nx">home_tnrap_hosting</span><span class="err">.</span><span class="nx">domain_name</span>
</code></pre></div></div>

<p><strong>Step 4: Review and Update Variables in <code class="language-plaintext highlighter-rouge">terraform.tfvars</code></strong></p>

<p>Review and update variables in the module configurations. If you need to set nested Terraform variables in the tfvars file, refer to Terraform documentation for guidance.</p>

<ol>
  <li>We asked GPT to help in this:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>How do u set nested tf variables in tf vars file.
</code></pre></div>    </div>
  </li>
</ol>

<p>This is to make stuff look more damn neat.</p>

<ul>
  <li>Remove previous <code class="language-plaintext highlighter-rouge">bucket_name</code>, <code class="language-plaintext highlighter-rouge">index_html_filepath</code>, <code class="language-plaintext highlighter-rouge">error_html_filepath</code> and <code class="language-plaintext highlighter-rouge">content_version</code> absolute path.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">index_html_filepath</span><span class="o">=</span><span class="s2">"/workspace/terraform-beginner-bootcamp-2023/public/index.html"</span>
<span class="nv">error_html_filepath</span><span class="o">=</span><span class="s2">"/workspace/terraform-beginner-bootcamp-2023/public/error.html"</span>
<span class="nv">assets_path</span><span class="o">=</span><span class="s2">"/workspace/terraform-beginner-bootcamp-2023/public/assets/"</span>
<span class="nv">content_version</span><span class="o">=</span>1
</code></pre></div></div>

<ul>
  <li>Update your <code class="language-plaintext highlighter-rouge">terraform.tfvars</code> and <code class="language-plaintext highlighter-rouge">terraform.tfvars.sample</code> input for the public path and the content version in union like this;</li>
</ul>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       <span class="nx">house</span><span class="err">-</span><span class="nx">name</span><span class="err">-</span><span class="mi">1</span> <span class="err">=</span> <span class="p">{</span>
       <span class="nx">public_path</span> <span class="p">=</span> <span class="s2">"/workspace/terraform-beginner-bootcamp-2023/public/tnrap"</span>
       <span class="nx">content_version</span> <span class="p">=</span> <span class="mi">1</span>
       <span class="p">}</span>

       <span class="nx">house</span><span class="err">-</span><span class="nx">name</span><span class="err">-</span><span class="mi">2</span> <span class="err">=</span> <span class="p">{</span>
       <span class="nx">public_path</span> <span class="p">=</span> <span class="s2">"/workspace/terraform-beginner-bootcamp-2023/public/tnfood"</span>
       <span class="nx">content_version</span> <span class="p">=</span> <span class="mi">1</span> 
       <span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 5: Modify Index Variables</strong></p>

<ul>
  <li>Remove previous <code class="language-plaintext highlighter-rouge">bucket_name</code>, <code class="language-plaintext highlighter-rouge">index_html_filepath</code>, <code class="language-plaintext highlighter-rouge">error_html_filepath</code> and <code class="language-plaintext highlighter-rouge">content_version</code> variables definition.</li>
</ul>

<p>Those in tfvars will be red inlined unless you perform the following task.</p>

<ul>
  <li>Modify the variables to include references to public paths for your homes in your <code class="language-plaintext highlighter-rouge">variables.tf</code> file instead as nested.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>variable "home-1" {
  type = object({
    public_path = string
    content_version = number
  })
}
.
.
.
variable "home-n" {
  type = object({
    public_path = string
    content_version = number
  })
}
</code></pre></div></div>

<p><strong>Step 6: <code class="language-plaintext highlighter-rouge">main.tf</code> root Remove Index and Error HTML References</strong></p>

<p>Remove the ‚Äúindex_html_filepath‚Äù and ‚Äúerror_html_filepath‚Äù from your module block, and replace them with references to the ‚Äúpublic_path‚Äù and ‚Äúcontent_version‚Äù variables.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"home_tnrap_hosting"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./modules/terrahome_aws"</span>
  <span class="nx">user_uuid</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">teacherseat_user_uuid</span>

  <span class="nx">public_path</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">arcanum</span><span class="err">.</span><span class="nx">public_path</span>
  <span class="nx">content_version</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">arcanum</span><span class="err">.</span><span class="nx">content_version</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 7: <code class="language-plaintext highlighter-rouge">main.tf</code> root Update Resource Configuration</strong></p>

<p>In the resource section, update the call with the new variables assigned to ‚Äúcloudfront‚Äù and ‚Äúcontent_version.‚Äù</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>resource "terratowns_home" "home" {
  name = "How to play Arcanum in 2023!"
  description = &lt;&lt;DESCRIPTION




DESCRIPTION
  domain_name = module.home_arcanum_hosting.domain_name
  town = ""
  content_version = var.arcanum.content_version
}
</code></pre></div></div>
<p><strong>Step 8: Storage Module Vars Update</strong></p>

<ol>
  <li>
    <p>Start with output.tf change the output <code class="language-plaintext highlighter-rouge">"cloudfront_url"</code> to <code class="language-plaintext highlighter-rouge">"domain_name"</code></p>
  </li>
  <li>
    <p>In <code class="language-plaintext highlighter-rouge">resource-storage.tf</code> change the <code class="language-plaintext highlighter-rouge">source</code> and <code class="language-plaintext highlighter-rouge">etag</code> path for <code class="language-plaintext highlighter-rouge">index_html</code>, <code class="language-plaintext highlighter-rouge">error_html</code> for <code class="language-plaintext highlighter-rouge">aws_s3_object</code> to map to our new vars.</p>
  </li>
</ol>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">source</span> <span class="err">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">index_html_filepath</span>
  <span class="nx">source</span> <span class="err">=</span> <span class="s2">"${var.public_path}/index.html"</span>

  <span class="nx">etag</span> <span class="err">=</span> <span class="nx">filemd5</span><span class="err">(</span><span class="nx">var</span><span class="err">.</span><span class="nx">index_html_filepath</span><span class="err">)</span>
  <span class="nx">etag</span> <span class="err">=</span> <span class="nx">filemd5</span><span class="err">(</span><span class="s2">"${var.public_path}/index.html"</span><span class="err">)</span>



  <span class="nx">source</span> <span class="err">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">error_html_filepath</span>
  <span class="nx">source</span> <span class="err">=</span> <span class="s2">"${var.public_path}/error.html"</span>

  <span class="nx">etag</span> <span class="err">=</span> <span class="nx">filemd5</span><span class="err">(</span><span class="nx">var</span><span class="err">.</span><span class="nx">error_html_filepath</span><span class="err">)</span>
  <span class="nx">etag</span> <span class="err">=</span> <span class="nx">filemd5</span><span class="err">(</span><span class="s2">"${var.public_path}/error.html"</span><span class="err">)</span>
</code></pre></div></div>

<ol>
  <li>In the same file update source, etag but also the <code class="language-plaintext highlighter-rouge">for_each</code> for <code class="language-plaintext highlighter-rouge">upload_assets</code>.</li>
</ol>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">for_each</span> <span class="err">=</span> <span class="nx">fileset</span><span class="err">(</span><span class="nx">var</span><span class="err">.</span><span class="nx">assets_path</span><span class="err">,</span><span class="s2">"*.{jpg,png,gif}"</span><span class="err">)</span>
  <span class="nx">for_each</span> <span class="err">=</span> <span class="nx">fileset</span><span class="err">(</span><span class="s2">"${var.public_path}/assets"</span><span class="err">,</span><span class="s2">"*.{jpg,png,gif}"</span><span class="err">)</span>

  <span class="nx">source</span> <span class="err">=</span> <span class="s2">"${var.assets_path}/${each.key}"</span>
  <span class="nx">etag</span> <span class="err">=</span> <span class="nx">filemd5</span><span class="err">(</span><span class="s2">"${var.assets_path}${each.key}"</span><span class="err">)</span>

  <span class="nx">source</span> <span class="err">=</span> <span class="s2">"${var.public_path}/assets/${each.key}"</span>
  <span class="nx">etag</span> <span class="err">=</span> <span class="nx">filemd5</span><span class="err">(</span><span class="s2">"${var.public_path}/assets/${each.key}"</span><span class="err">)</span>
</code></pre></div></div>

<p><strong>Step 9: Module <code class="language-plaintext highlighter-rouge">variables.tf</code> Updates</strong></p>
<ol>
  <li>change our <code class="language-plaintext highlighter-rouge">index_html_filepath</code> variable to <code class="language-plaintext highlighter-rouge">public_path</code> instead.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"public_path"</span> <span class="p">{}</span>
</code></pre></div>    </div>
  </li>
  <li>Remove its validation and rename its description.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">description</span> <span class="err">=</span> <span class="s2">"The file path for the public directory"</span>
</code></pre></div>    </div>
  </li>
  <li>Leave it type string as it is.
    <div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">type</span>    <span class="err">=</span> <span class="nx">string</span>
</code></pre></div>    </div>
  </li>
  <li>in the same file, terminate both <code class="language-plaintext highlighter-rouge">assets_path</code> and <code class="language-plaintext highlighter-rouge">error_html_filepath</code> and its validation.</li>
</ol>

<p><strong>Step 8: Duplicate Step 5-6-7 for Another Home</strong></p>

<p>Duplicate the entire process for the module/resource to create a new home just below it.</p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"home_tnfood_hosting"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./modules/terrahome_aws"</span>
  <span class="nx">user_uuid</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">teacherseat_user_uuid</span>
  <span class="nx">public_path</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">tnfood</span><span class="err">.</span><span class="nx">public_path</span>
  <span class="nx">content_version</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">tnfood</span><span class="err">.</span><span class="nx">content_version</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"terratowns_home"</span> <span class="s2">"home_tnfood"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"Showing you our Tunisian Food"</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">DESCRIPTION</span><span class="sh">

Add yours here!
</span><span class="no">
DESCRIPTION
</span>  <span class="nx">domain_name</span> <span class="p">=</span> <span class="nx">module</span><span class="err">.</span><span class="nx">home_tnfood_hosting</span><span class="err">.</span><span class="nx">domain_name</span>
  <span class="nx">town</span> <span class="p">=</span> <span class="s2">"missingo"</span>
  <span class="nx">content_version</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">tnfood</span><span class="err">.</span><span class="nx">content_version</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 9: Build and Deploy</strong></p>

<p>To deploy your changes, follow these steps:</p>

<ol>
  <li>Ensure you are in the project directory, go to .gitpod.yml</li>
  <li>add the following command with source below the copy command:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">cp</span> <span class="nv">$PROJECT_ROOT</span>/terraform.tfvars.example <span class="nv">$PROJECT_ROOT</span>/terraform.tfvars
  <span class="nb">source</span> ./bin/build_provider
</code></pre></div></div>
<p>3.Run tf init to initialize your infra and new resources.</p>
<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">tf plan</code>, observe and run <code class="language-plaintext highlighter-rouge">tf apply</code>.</li>
</ol>

<p><img src="/assets/2.7.0/two-pages-post.png" alt="Terraform Applied for both resources" /></p>

<p>With these changes, you should be able to see both pages listed in your Terraform Cloud dashboard.</p>

<h2 id="the-first-music-post">The First Music Post</h2>

<p><img src="/assets/2.7.0/music-post.png" alt="Tunisian Rap TerraHouse Post" /></p>

<h3 id="check-out-the-music-home">Check out The Music Home</h3>

<p>‚Üí <a href="https://d2y3y5anu2c2ur.cloudfront.net/">TerraTowns Independent Link</a></p>

<p><img src="/assets/2.7.0/my-second-home.png" alt="Tunisian Rap TerraHouse" /></p>

<h2 id="check-out-the-tunisian-food-post">Check Out The Tunisian Food Post</h2>

<p><img src="/assets/2.7.0/foodhome-post.png" alt="Tunisian Food TerraHouse Post" /></p>

<h3 id="check-out-the-list-in-terrahome">Check Out The list in TerraHome</h3>

<p>‚Üí <a href="https://d3opm9jrs6v4zx.cloudfront.net/">TerraTowns Independent Link</a></p>

<p><img src="/assets/2.7.0/food-from-terratowns.png" alt="Tunisian Food TerraHouse" /></p>

<h3 id="terraform-state-management">Terraform State Management</h3>

<ol>
  <li>Execute <code class="language-plaintext highlighter-rouge">tf state list</code> to view the resources in Terraform Cloud within Gitpod.</li>
  <li>Perform <code class="language-plaintext highlighter-rouge">tf state pull</code> to get the latest from tfcloud.</li>
</ol>

<h3 id="troubleshooting-and-finalization">Troubleshooting and Finalization</h3>

<ol>
  <li>Address any errors encountered during the plan and apply phases.</li>
  <li>Resolve undefined index, etag path, or other issues.</li>
  <li>Update outputs to match changes made in the configuration.</li>
  <li>Ensure the plan and apply phases complete successfully.</li>
  <li>Confirm changes in the Terraform Cloud interface.</li>
  <li>Delete the Terraform Cloud resources if necessary.</li>
</ol>

<h3 id="joyful-conclusion">Joyful conclusion</h3>

<p>Version <code class="language-plaintext highlighter-rouge">2.7.0</code> originally <code class="language-plaintext highlighter-rouge">2.6.0</code> of the project focuses on integrating Terraform Cloud, enabling the creation of multiple homes or houses, and ensuring efficient configuration management.</p>

<p><strong>Show your creativity.</strong><br />
Make more homes!</p>

<h1 id="terratowns-potential-unlocked">TerraTowns Potential Unlocked</h1>

<p>In the earlier release tagged as <code class="language-plaintext highlighter-rouge">2.7.0</code>, originally conceived as <code class="language-plaintext highlighter-rouge">2.6.0</code>, I decided to refine the curriculum for your benefit and your understanding.</p>

<p><img src="/assets/2.7.1/terratowns.png" alt="TerraTowns" /></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">2.6.0</code> ‚Äî <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tree/2.6.0">Work with terraform cloud and local execution.</a></li>
  <li><code class="language-plaintext highlighter-rouge">2.7.0</code> ‚Äî <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tree/2.7.0">Create Two TerraHomes and adhrere to the House Theme.</a></li>
  <li><code class="language-plaintext highlighter-rouge">2.7.1</code> ‚Äî <a href="#terrahome-coding-a-new-home">Create Three More Homes and Target All TerraTowns.</a></li>
</ul>

<p><img src="/assets/2.7.1/available-towns.png" alt="All The Themes Available" /></p>

<p>Today, our aim is to address the remaining three endpoints, unlocking the full potential of Terratown.</p>

<p>We end up with a total of six projects nested within our <code class="language-plaintext highlighter-rouge">/public</code> repository.</p>

<ul>
  <li><a href="#terrahomes-delivery">TerraHomes Delivery</a></li>
</ul>

<p>This Incl. 1 <strong>Mixer</strong> town for testing in Missingo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>üìÅ./Terraformer
  |‚îÄ üè† favshow
  |   ‚îî‚îÄ üìÇ assets
  |   |   ‚îî‚îÄ üñºÔ∏è 26-july-2018-bb-ban.png
  |   |   ‚îî‚îÄ üñºÔ∏è august-18-2018.jpeg
  |   |   ‚îî‚îÄ üñºÔ∏è bb-26-july-2018.png
  |   |   ‚îî‚îÄ üñºÔ∏è br-ba-logo.png
  |   ‚îî‚îÄ üìÑ error.html
  |   ‚îî‚îÄ üìÑ index.html
  |‚îÄ üè† lolplayz
  |   ‚îî‚îÄ üìÇ assets
  |   |   ‚îî‚îÄ üñºÔ∏è 2019-got-serious-to-college.jpeg
  |   |   ‚îî‚îÄ üñºÔ∏è favi.png
  |   |   ‚îî‚îÄ üñºÔ∏è gamer-ERR.png
  |   |   ‚îî‚îÄ üñºÔ∏è gamer-proof.jpeg
  |   |   ‚îî‚îÄ üñºÔ∏è gamer-webpage-somejs.png
  |   |   ‚îî‚îÄ üñºÔ∏è gold-lol-18-aug-2018.jpeg
  |   |   ‚îî‚îÄ üñºÔ∏è lol-chall.jpeg
  |   |   ‚îî‚îÄ üñºÔ∏è old-time.jpeg
  |   ‚îî‚îÄ üìÑ error.html
  |   ‚îî‚îÄ üìÑ index.html
  |‚îÄ üè† mixer
  |   ‚îî‚îÄ üìÇ assets
  |   |   ‚îî‚îÄ üñºÔ∏è elizabeth-7-deadly-sins.png
  |   |   ‚îî‚îÄ üñºÔ∏è goku.jpg
  |   ‚îî‚îÄ üìÑ error.html
  |   ‚îî‚îÄ üìÑ index.html
  |   ‚îî‚îÄ üìÑ oldindex.html
  |‚îÄ üè† tnfood
  |   ‚îî‚îÄ üìÇ assets
  |   |   ‚îî‚îÄ üñºÔ∏è bambalouni.jpg
  |   |   ‚îî‚îÄ üñºÔ∏è couscous.jpg
  |   |   ‚îî‚îÄ üñºÔ∏è food-error-page.png
  |   |   ‚îî‚îÄ üñºÔ∏è food-terrahome.png
  |   |   ‚îî‚îÄ üñºÔ∏è lablebi.jpg
  |   |   ‚îî‚îÄ üñºÔ∏è LA-MLOUKHIA.png
  |   |   ‚îî‚îÄ üñºÔ∏è makroud.jpg
  |   |   ‚îî‚îÄ üñºÔ∏è slata-mechouia.jpg
  |   |   ‚îî‚îÄ üñºÔ∏è tunisian-food-masfouf.jpg
  |   ‚îî‚îÄ üìÑ error.html
  |   ‚îî‚îÄ üìÑ index.html
  |‚îÄ üè† tnrap
  |   ‚îî‚îÄ üìÇ assets
  |   |   ‚îî‚îÄ üñºÔ∏è loading-lazy.png
  |   |   ‚îî‚îÄ üñºÔ∏è music-terratown.png
  |   |   ‚îî‚îÄ üñºÔ∏è tn-music-errored.png
  |   ‚îî‚îÄ üìÑ error.html
  |   ‚îî‚îÄ üìÑ index.html
  ‚îî‚îÄ üè† travlz
      ‚îî‚îÄ üìÇ assets
      |   ‚îî‚îÄ üñºÔ∏è el-jem.jpg
      |   ‚îî‚îÄ üñºÔ∏è medina.jpg
      |   ‚îî‚îÄ üñºÔ∏è moss.jpg
      |   ‚îî‚îÄ üñºÔ∏è musee-bardo.JPG
      |   ‚îî‚îÄ üñºÔ∏è sidi.jpg
      |   ‚îî‚îÄ üñºÔ∏è sousse-ribat.JPG
      |   ‚îî‚îÄ üñºÔ∏è tn.png
      |   ‚îî‚îÄ üñºÔ∏è travel-err.png
      |   ‚îî‚îÄ üñºÔ∏è travel-page.png
      |   ‚îî‚îÄ üñºÔ∏è tunis.jpg
      |   ‚îî‚îÄ üñºÔ∏è zitounaaa.jpg
      ‚îî‚îÄ üìÑ error.html
      ‚îî‚îÄ üìÑ index.html
</code></pre></div></div>

<p>I ensured that these homes reflect my personality, allowing me to reveal more about who I am as a great person.</p>

<h3 id="terrahome-coding-a-new-home">TerraHome: Coding a New Home</h3>
<p>In the following section, we will cover the steps necessary for you to add a new home.</p>

<p>Although we‚Äôve already covered this process in the previous version 2.7.0, we will do it again to assure we know what we are doing.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Instructions assume that you have configured your variables at the module level</th>
      <th style="text-align: center"><a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tree/2.7.0">Here</a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">¬†</td>
      <td style="text-align: center">¬†</td>
    </tr>
  </tbody>
</table>

<ol>
  <li>Create a new <strong>TerraHome</strong> in the <code class="language-plaintext highlighter-rouge">public</code> directory.</li>
</ol>

<p>I can‚Äôt instruct you further what you are allowed to create inside. <br />I end up following the rules creating html files and assets. <br /> Feel free to break them please.<br />Do more.</p>

<p>When your projects are in place. Follow this configuration as code.</p>

<ol>
  <li>Create a module in your main.tf with the home name e.g.</li>
</ol>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"home_change-this_hosting"</span> <span class="p">{}</span>
</code></pre></div></div>

<ol>
  <li>Go define your Home variables in <code class="language-plaintext highlighter-rouge">variables.tf</code> for the new home.</li>
</ol>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">variable</span> <span class="s2">"change-this"</span>

<span class="p">{</span>
      <span class="nx">type</span> <span class="p">=</span> <span class="nx">object</span>

      <span class="p">(</span>
        <span class="p">{</span>
            <span class="nx">public_path</span> <span class="p">=</span> <span class="nx">string</span>

            <span class="nx">content_version</span> <span class="p">=</span> <span class="nx">number</span>
        <span class="p">}</span>          
      <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>Set the actual content of your new home variables in your <code class="language-plaintext highlighter-rouge">terraform.tfvars</code></li>
</ol>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">change</span><span class="err">-</span><span class="nx">this</span> <span class="err">=</span> <span class="p">{</span>

  <span class="nx">public_path</span> <span class="p">=</span> <span class="s2">"/workspace/terraform-beginner-bootcamp-2023/public/change-this"</span>

  <span class="nx">content_version</span> <span class="p">=</span> <span class="mi">1</span> 
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>Go back to your module in <code class="language-plaintext highlighter-rouge">main.tf</code> and configure your <code class="language-plaintext highlighter-rouge">public_path</code> and <code class="language-plaintext highlighter-rouge">content_version</code> with these variables.</li>
</ol>

<div class="language-tf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="s2">"home_change-this_hosting"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"./modules/terrahome_aws"</span>
  <span class="nx">user_uuid</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">teacherseat_user_uuid</span>
  <span class="nx">public_path</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">change</span><span class="err">-</span><span class="nx">this</span><span class="p">.</span><span class="nx">public_path</span>
  <span class="nx">content_version</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">change</span><span class="err">-</span><span class="nx">this</span><span class="p">.</span><span class="nx">content_version</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>To make sure your new home variables are safe, copy the content from your <code class="language-plaintext highlighter-rouge">terraform.tfvars</code> to <code class="language-plaintext highlighter-rouge">terraform.tfvars.sample</code></li>
</ol>

<blockquote>
  <p>Remmber we have a <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/blob/2.7.0/.gitpod.yml#L10C1-L10C1">cp command</a> to get that content.</p>
</blockquote>

<p>That it with the configuration.</p>

<p>More homes? <a href="#terrahome-coding-a-new-home">Read this</a> again.</p>

<h3 id="terrahomes-delivery">TerraHomes Delivery</h3>

<p>Terraform configured? Project Files correctly tested? Ready to launch.</p>

<ol>
  <li>Run the <code class="language-plaintext highlighter-rouge">build_provider</code> script to get the binairy.</li>
  <li>Make sure you sinatra server is running, if not run
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle install
bundle exec ruby server.rb 
</code></pre></div>    </div>
  </li>
  <li>Terraform init and make sure you are authenticated to terraform cloud, if not run and get that token.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform login
</code></pre></div>    </div>
  </li>
  <li><code class="language-plaintext highlighter-rouge">terraform plan</code> to see the great stuff coming in.</li>
  <li><code class="language-plaintext highlighter-rouge">terraform apply -lock=false</code> in cases your state is locked in tf cloud.</li>
</ol>

<p><img src="/assets/2.7.1/apply-updates.png" alt="Applied Infrastructure" /></p>

<ul>
  <li>The existing homes will be updated if any updates are available.</li>
  <li>The new homes can be added with that single command.</li>
  <li>The hard part is always building the infra like a symphony.</li>
</ul>

<h2 id="terratowns-deliverables">TerraTowns Deliverables</h2>

<p>As I mentioned before, I designed TerraHomes for every town. This section serves as a showcase of the most recent three additions.</p>

<p>‚Üí To <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/issues/65">learn more about the methodology.</a></p>

<h3 id="breaking-bad-fanpage">Breaking Bad FanPage</h3>

<p>This page is my way of expressing my admiration for the TV show. I‚Äôve incorporated a quote generator and included assets that hold sentimental value from a dear friend.</p>

<p>The post Title and description specified;</p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">name</span> <span class="err">=</span> <span class="s2">"The Best TV Show You'll Ever Watch"</span>

<span class="nx">description</span> <span class="err">=</span> <span class="o">&lt;&lt;</span><span class="no">DESCRIPTION</span><span class="sh">
üí•Join us as we unravel the gripping tale of high-stakes crime, morality, and transformation that has captured the hearts of millions worldwide.üí•
</span><span class="no">DESCRIPTION
</span></code></pre></div></div>

<h3 id="terratown-post-show-up">TerraTown Post Show Up</h3>

<p><img src="/assets/2.7.1/1-bb-post.png" alt="Breaking Bad FanPage Post" /></p>

<h3 id="the-project-terrahome">The Project TerraHome</h3>
<p>|<a href="https://terratowns.cloud/h/48154dbb-6d35-42bf-a06a-3eeb775c9bb2">Internal URL</a>|<a href="https://ds3mmnyp4l57k.cloudfront.net/">CloudFront URL</a>|
|‚Äì|‚Äì|
|||</p>

<p><img src="/assets/2.7.1/2-bb-home.png" alt="Breaking Bad FanPage" /></p>

<h3 id="past-gaming-passion">Past Gaming Passion</h3>
<p>This project is a highlight to what I used to play a lot in the past. It gives some insights to why I am good in english? And why I find mysef a master in the cloud?</p>

<p>The post Title and description specified;</p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">name</span> <span class="err">=</span> <span class="s2">"What Yahya Used To play A lot?"</span>

<span class="nx">description</span> <span class="err">=</span> <span class="o">&lt;&lt;</span><span class="no">DESCRIPTION</span><span class="sh">
Uncover Yahya's past gaming obsession and how his extensive involvement with League of Legends eventually severed that connection, enabling him to devote more time to other pursuits.
</span><span class="no">DESCRIPTION
</span></code></pre></div></div>

<h3 id="terratown-post-show-up-1">TerraTown Post Show Up</h3>

<p><img src="/assets/2.7.1/1-gamer-post.png" alt="League Of Legends Post" /></p>

<h3 id="the-project-terrahome-1">The Project TerraHome</h3>

<table>
  <thead>
    <tr>
      <th><a href="https://terratowns.cloud/h/15828552-3f2e-4ffa-82ff-40a719bac5ec">Internal URL</a></th>
      <th><a href="https://d3fozmkbn0u7h4.cloudfront.net/">CloudFront URL</a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>¬†</td>
      <td>¬†</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/2.7.1/2-gamer-home.png" alt="League Of Legends WebPage" /></p>

<h3 id="visit-tunisia">Visit Tunisia</h3>
<p>Our economy is a bit messed up but we have great places.</p>

<p>I think a smart person can visit have lots of fun with dead cheap money and go back happy.</p>

<p>The post Title and description specified;</p>
<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">name</span> <span class="err">=</span> <span class="s2">"The Best TV Show You'll Ever Watch"</span>

<span class="nx">description</span> <span class="err">=</span> <span class="o">&lt;&lt;</span><span class="no">DESCRIPTION</span><span class="sh">
üí•Join us as we unravel the gripping tale of high-stakes crime, morality, and transformation that has captured the hearts of millions worldwide.üí•
</span><span class="no">DESCRIPTION
</span><span class="err">}</span>
</code></pre></div></div>

<h3 id="terratown-post-show-up-2">TerraTown Post Show Up</h3>

<p><img src="/assets/2.7.1/1-country-post.png" alt="Visit Tunisia Post" /></p>

<h3 id="the-project-terrahome-2">The Project TerraHome</h3>

<table>
  <thead>
    <tr>
      <th><a href="https://terratowns.cloud/h/db7565bc-33dc-4f65-8b45-8eca2c4c628a">Internal URL</a></th>
      <th><a href="https://d1z96397cxwgol.cloudfront.net/">CloudFront URL</a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>¬†</td>
      <td>¬†</td>
    </tr>
  </tbody>
</table>

<p><img src="/assets/2.7.1/2-country-home.png" alt="Visit Tunisia WebPage" /></p>

<h3 id="considerations-2">Considerations</h3>

<p><strong>Unsupported Image Format (JPEG):</strong> <br />
Corrected the issue where JPEG images were not supported.<br />
<strong>Image Format Conversion (JPEG to PNG):</strong> <br />
Converted the existing JPEG images to PNG format to ensure compatibility with the project.<br />
<strong>File Extension Renaming (JPG to jpg):</strong> <br />
Modified file extensions from ‚ÄúJPG‚Äù to ‚Äújpg‚Äù for consistent and standardized naming.<br />
<strong>User Interface and Slider Enhancements:</strong> <br />
Made necessary fixes and improvements to the user interface and slider functionality to enhance the project‚Äôs overall usability and appearance.</p>

<hr />

<p>In case you weren‚Äôt aware, all the strategies I used have been revealed.<br /> 
My relentless pursuit is your advantage.</p>

<ul>
  <li><a href="/assets/2.7.1/connect.html">Chats Got TerraHomes Done</a></li>
  <li><a href="public/yayauptree.md">Tree and Beautify</a></li>
  <li><a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tree/3.1.0/assets/3.1.0">ExamProCo Snapshot</a></li>
</ul>

<p>There is no personal draft notes this time. Because there was none. <br />I freestyled my mind in this.</p>

<blockquote>
  <p>Creativity knows no bounds, and in the absence of drafts, the untamed mind finds its truest expression.</p>
</blockquote>


        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      
      <p><a href="https://github.com/yaya2devops" class="avatar"><img src="https://github.com/yaya2devops.png" width="48" height="48"></a> <a href="https://github.com/yaya2devops">yaya2devops</a> maintains <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023">Cloud Express</a></p>
      

       

      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    
    <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/tarball/gh-pages" class="tar">tar</a>
    <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023/zipball/gh-pages" class="zip">zip</a>
    <a href="https://github.com/yaya2devops/terraform-beginner-bootcamp-2023" class="code">source code</a>
    
    <p class="name"></p>
  </div>
</body>
</html>
